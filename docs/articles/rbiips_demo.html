<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>rbiips demo • rbiips</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><meta property="og:title" content="rbiips demo">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rbiips</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.11.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/rbiips_demo.html">rbiips demo</a>
    </li>
    <li>
      <a href="../articles/rbiips_examples.html">rbiips example</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/biips/rbiips">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>rbiips demo</h1>
                        <h4 class="author">Adrien Todeschini, François Caron</h4>
            
            <h4 class="date">2018-04-16</h4>
      
      <small>Source: <a href="https://github.com/biips/rbiips/blob/master/vignettes/rbiips_demo.Rmd"><code>vignettes/rbiips_demo.Rmd</code></a></small>

    </div>

    
    
<div class="contents">
<p>This is a quick demo of <code>rbiips</code> main functions.</p>
<p>Disclaimer: for speed of execution, we use very few particles and MCMC iterations in this vignette. As such, the results are not representative of the perforance of SMC and particle MCMC methods.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">0</span>)
<span class="kw">library</span>(rbiips)</code></pre></div>
<div id="add-custom-functions-and-distributions-to-bugs-language" class="section level1">
<h1 class="hasAnchor">
<a href="#add-custom-functions-and-distributions-to-bugs-language" class="anchor"></a>Add custom functions and distributions to BUGS language</h1>
<p>Add custom function <code>f</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">f_dim &lt;-<span class="st"> </span><span class="cf">function</span>(x_dim, t_dim) {
  <span class="co"># Check dimensions of the input and return dimension of the output of function f</span>
  <span class="kw">stopifnot</span>(<span class="kw">prod</span>(x_dim) <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="kw">prod</span>(t_dim) <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)
  x_dim
}
f_eval &lt;-<span class="st"> </span><span class="cf">function</span>(x, t) {
  <span class="co"># Evaluate function f</span>
  <span class="fl">0.5</span> <span class="op">*</span><span class="st"> </span>x <span class="op">+</span><span class="st"> </span><span class="dv">25</span> <span class="op">*</span><span class="st"> </span>x<span class="op">/</span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>x<span class="op">^</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span><span class="dv">8</span> <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(<span class="fl">1.2</span> <span class="op">*</span><span class="st"> </span>t)
}
<span class="kw"><a href="../reference/extend-bugs.html">biips_add_function</a></span>(<span class="st">'f'</span>, <span class="dv">2</span>, f_dim, f_eval)</code></pre></div>
<pre><code>## * Added function f</code></pre>
<p>Add custom sampling distribution <code>dMN</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dMN_dim &lt;-<span class="st"> </span><span class="cf">function</span>(mu_dim, Sig_dim) {
  <span class="co"># Check dimensions of the input and return dimension of the output of</span>
  <span class="co"># distribution dMN</span>
  <span class="kw">stopifnot</span>(<span class="kw">prod</span>(mu_dim) <span class="op">==</span><span class="st"> </span>mu_dim[<span class="dv">1</span>], <span class="kw">length</span>(Sig_dim) <span class="op">==</span><span class="st"> </span><span class="dv">2</span>, mu_dim[<span class="dv">1</span>] <span class="op">==</span><span class="st"> </span>Sig_dim)
  mu_dim
}
dMN_sample &lt;-<span class="st"> </span><span class="cf">function</span>(mu, Sig) {
  <span class="co"># Draw a sample of distribution dMN</span>
  mu <span class="op">+</span><span class="st"> </span><span class="kw">t</span>(<span class="kw">chol</span>(Sig)) <span class="op">%*%</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="kw">length</span>(mu))
}
<span class="kw"><a href="../reference/extend-bugs.html">biips_add_distribution</a></span>(<span class="st">'dMN'</span>, <span class="dv">2</span>, dMN_dim, dMN_sample)</code></pre></div>
<pre><code>## * Added distribution dMN</code></pre>
</div>
<div id="compile-model" class="section level1">
<h1 class="hasAnchor">
<a href="#compile-model" class="anchor"></a>Compile model</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">modelfile &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">'extdata'</span>, <span class="st">'hmm_f.bug'</span>, <span class="dt">package =</span> <span class="st">'rbiips'</span>)
<span class="kw">stopifnot</span>(<span class="kw">nchar</span>(modelfile) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)
<span class="kw">cat</span>(<span class="kw">readLines</span>(modelfile), <span class="dt">sep =</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</code></pre></div>
<pre><code>## var c_true[tmax], x_true[tmax], c[tmax], x[tmax], y[tmax]
## 
## data
## {
##   x_true[1] ~ dnorm(0, 1/5)
##   y[1] ~ dnorm(x_true[1], exp(logtau_true))
##   for (t in 2:tmax)
##   {
##     c_true[t] ~ dcat(p)
##     x_true[t] ~ dnorm(f(x_true[t-1], t-1), ifelse(c_true[t]==1, 1/10, 1/100))
##     y[t] ~ dnorm(x_true[t]/4, exp(logtau_true))
##   }
## }
## 
## model
## {
##   logtau ~ dunif(-3, 3)
##   x[1] ~ dnorm(0, 1/5)
##   y[1] ~ dnorm(x[1], exp(logtau))
##   for (t in 2:tmax)
##   {
##     c[t] ~ dcat(p)
##     x[t] ~ dnorm(f(x[t-1], t-1), ifelse(c[t]==1, 1/10, 1/100))
##     y[t] ~ dnorm(x[t]/4, exp(logtau))
##   }
## }</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tmax &lt;-<span class="st"> </span><span class="dv">10</span>
data_ &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">tmax =</span> tmax, <span class="dt">p =</span> <span class="kw">c</span>(.<span class="dv">5</span>, .<span class="dv">5</span>), <span class="dt">logtau_true =</span> <span class="kw">log</span>(<span class="dv">1</span>), <span class="dt">logtau =</span> <span class="kw">log</span>(<span class="dv">1</span>))
model &lt;-<span class="st"> </span><span class="kw"><a href="../reference/biips_model.html">biips_model</a></span>(modelfile, data_, <span class="dt">sample_data =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## * Parsing model in: /home/adrien/R/x86_64-pc-linux-gnu-library/3.4/rbiips/extdata/hmm_f.bug
## * Compiling data graph
##   Declaring variables
##   Resolving undeclared variables
##   Allocating nodes
##   Graph size: 94
##   Sampling data
##   Reading data back into data table
## * Compiling model graph
##   Declaring variables
##   Resolving undeclared variables
##   Allocating nodes
##   Graph size: 105</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data_ =<span class="st"> </span>model<span class="op">$</span><span class="kw">data</span>()</code></pre></div>
</div>
<div id="smc-algorithm" class="section level1">
<h1 class="hasAnchor">
<a href="#smc-algorithm" class="anchor"></a>SMC algorithm</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">n_part &lt;-<span class="st"> </span><span class="dv">100</span>
out_smc &lt;-<span class="st"> </span><span class="kw"><a href="../reference/biips_smc_samples.html">biips_smc_samples</a></span>(model, <span class="kw">c</span>(<span class="st">'x'</span>, <span class="st">'c[2:10]'</span>, <span class="st">'x[5]'</span>, <span class="st">'c[5]'</span>), 
                             n_part, <span class="dt">type =</span> <span class="st">'fs'</span>,
                             <span class="dt">rs_thres =</span> <span class="fl">0.5</span>, <span class="dt">rs_type =</span> <span class="st">'stratified'</span>)</code></pre></div>
<pre><code>## * Assigning node samplers
## * Running SMC forward sampler with 100 particles
##   |--------------------------------------------------| 100%
##   |**************************************************| 10 iterations in 0.04 s</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/smcarray-object.html">biips_diagnosis</a></span>(out_smc)</code></pre></div>
<pre><code>## * Diagnosis of variable: c[2:10] 
##   Filtering: GOOD
##   Smoothing: POOR
##     The minimum effective sample size is too low: 27.97195 
##     Estimates may be poor for some variables.
##     You should increase the number of particles
## .* Diagnosis of variable: c[5] 
##   Filtering: GOOD
##   Smoothing: POOR
##     The minimum effective sample size is too low: 27.97195 
##     Estimates may be poor for some variables.
##     You should increase the number of particles
## .* Diagnosis of variable: x[1:10] 
##   Filtering: GOOD
##   Smoothing: POOR
##     The minimum effective sample size is too low: 27.97195 
##     Estimates may be poor for some variables.
##     You should increase the number of particles
## .* Diagnosis of variable: x[5] 
##   Filtering: GOOD
##   Smoothing: POOR
##     The minimum effective sample size is too low: 27.97195 
##     Estimates may be poor for some variables.
##     You should increase the number of particles
## .</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">summ_smc &lt;-<span class="st"> </span><span class="kw"><a href="../reference/smcarray-object.html">biips_summary</a></span>(out_smc, <span class="dt">probs=</span><span class="kw">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))

<span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="dt">bty=</span><span class="st">'l'</span>)

<span class="kw">matplot</span>(<span class="kw">do.call</span>(cbind, summ_smc<span class="op">$</span>x<span class="op">$</span>f<span class="op">$</span>quant), 
        <span class="dt">type=</span><span class="st">'n'</span>, <span class="dt">xlab=</span><span class="st">'t'</span>, <span class="dt">ylab=</span><span class="st">'x[t]'</span>)
<span class="kw">lines</span>(summ_smc<span class="op">$</span>x<span class="op">$</span>f<span class="op">$</span>mean)
<span class="kw">matlines</span>(<span class="kw">do.call</span>(cbind, summ_smc<span class="op">$</span>x<span class="op">$</span>f<span class="op">$</span>quant), <span class="dt">col=</span><span class="dv">1</span>, <span class="dt">lty=</span><span class="dv">2</span>)
<span class="kw">lines</span>(summ_smc<span class="op">$</span>x<span class="op">$</span>s<span class="op">$</span>mean, <span class="dt">col=</span><span class="dv">2</span>)
<span class="kw">matlines</span>(<span class="kw">do.call</span>(cbind, summ_smc<span class="op">$</span>x<span class="op">$</span>s<span class="op">$</span>quant), <span class="dt">col=</span><span class="dv">2</span>, <span class="dt">lty=</span><span class="dv">2</span>)
<span class="kw">lines</span>(data_<span class="op">$</span>x_true, <span class="dt">col=</span><span class="dv">3</span>)
<span class="kw">legend</span>(<span class="st">'topleft'</span>, 
       <span class="dt">leg=</span><span class="kw">c</span>(<span class="st">'SMC filtering estimate'</span>,
             <span class="st">'SMC smoothing estimate'</span>, <span class="st">'true'</span>),
       <span class="dt">col=</span><span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">lty=</span><span class="dv">1</span>, <span class="dt">bty=</span><span class="st">'n'</span>)

<span class="kw">matplot</span>(<span class="kw">c</span>(<span class="dv">1</span>,tmax), <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">4</span>), <span class="dt">type=</span><span class="st">'n'</span>, <span class="dt">xlab=</span><span class="st">'t'</span>, <span class="dt">ylab=</span><span class="st">'c[t]==1'</span>, <span class="dt">yaxt=</span><span class="st">'n'</span>)
<span class="kw">lines</span>(<span class="dv">2</span><span class="op">:</span>tmax, <span class="dv">2</span><span class="op">+</span>summ_smc[[<span class="st">'c[2:10]'</span>]]<span class="op">$</span>f<span class="op">$</span>mode, <span class="dt">type=</span><span class="st">'S'</span>)
<span class="kw">lines</span>(<span class="dv">2</span><span class="op">:</span>tmax, .<span class="dv">5</span><span class="op">+</span>summ_smc[[<span class="st">'c[2:10]'</span>]]<span class="op">$</span>s<span class="op">$</span>mode, <span class="dt">type=</span><span class="st">'S'</span>, <span class="dt">col=</span><span class="dv">2</span>)
<span class="kw">lines</span>(<span class="op">-</span><span class="dv">1</span><span class="op">+</span>data_<span class="op">$</span>c_true, <span class="dt">type=</span><span class="st">'S'</span>, <span class="dt">col=</span><span class="dv">3</span>)
<span class="kw">legend</span>(<span class="st">'topleft'</span>, 
       <span class="dt">leg=</span><span class="kw">c</span>(<span class="st">'SMC filtering mode'</span>,
             <span class="st">'SMC smoothing mode'</span>, <span class="st">'true'</span>),
       <span class="dt">col=</span><span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">lty=</span><span class="dv">1</span>, <span class="dt">bty=</span><span class="st">'n'</span>)

<span class="kw">plot</span>(<span class="kw"><a href="../reference/smcarray-object.html">biips_density</a></span>(out_smc[[<span class="st">'x[5]'</span>]]))
<span class="kw">abline</span>(<span class="dt">v=</span>data_<span class="op">$</span>x_true[<span class="dv">5</span>], <span class="dt">col=</span><span class="dv">3</span>)

<span class="kw">plot</span>(<span class="kw"><a href="../reference/smcarray-object.html">biips_table</a></span>(out_smc[[<span class="st">'c[5]'</span>]]))
<span class="kw">points</span>(data_<span class="op">$</span>c_true[<span class="dv">5</span>], <span class="dv">0</span>, <span class="dt">col=</span><span class="dv">3</span>, <span class="dt">pch=</span><span class="dv">17</span>)</code></pre></div>
<p><img src="rbiips_demo_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
</div>
<div id="pimh-algorithm" class="section level1">
<h1 class="hasAnchor">
<a href="#pimh-algorithm" class="anchor"></a>PIMH algorithm</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">n_part &lt;-<span class="st"> </span><span class="dv">50</span>
obj_pimh &lt;-<span class="st"> </span><span class="kw"><a href="../reference/biips_pimh_init.html">biips_pimh_init</a></span>(model, <span class="kw">c</span>(<span class="st">'x'</span>, <span class="st">'c[2:10]'</span>, <span class="st">'x[5]'</span>, <span class="st">'c[5]'</span>))  <span class="co"># Initialize</span></code></pre></div>
<pre><code>## * Initializing PIMH</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">out_pimh_burn &lt;-<span class="st"> </span><span class="kw"><a href="../reference/pimh-object.html">biips_pimh_update</a></span>(obj_pimh, <span class="dv">100</span>, n_part)  <span class="co"># Burn-in</span></code></pre></div>
<pre><code>## * Updating PIMH with 50 particles
##   |--------------------------------------------------| 100%
##   |**************************************************| 100 iterations in 1.87 s</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">out_pimh &lt;-<span class="st"> </span><span class="kw"><a href="../reference/pimh-object.html">biips_pimh_samples</a></span>(obj_pimh, <span class="dv">100</span>, n_part)  <span class="co"># Samples</span></code></pre></div>
<pre><code>## * Generating PIMH samples with 50 particles
##   |--------------------------------------------------| 100%
##   |**************************************************| 100 iterations in 1.85 s</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">summ_pimh &lt;-<span class="st"> </span><span class="kw"><a href="../reference/smcarray-object.html">biips_summary</a></span>(out_pimh, <span class="dt">probs=</span><span class="kw">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))

<span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">1</span>), <span class="dt">bty=</span><span class="st">'l'</span>)

<span class="kw">plot</span>(<span class="kw">c</span>(out_pimh_burn<span class="op">$</span>log_marg_like, out_pimh<span class="op">$</span>log_marg_like),
     <span class="dt">type =</span> <span class="st">'l'</span>, <span class="dt">xlab =</span> <span class="st">'PIMH iteration'</span>, <span class="dt">ylab =</span> <span class="st">'log p(y)'</span>)

<span class="kw">plot</span>(<span class="dv">101</span><span class="op">:</span><span class="dv">200</span>, <span class="kw">c</span>(out_pimh[[<span class="st">'x[5]'</span>]]),
     <span class="dt">type =</span> <span class="st">'l'</span>, <span class="dt">xlab =</span> <span class="st">'PIMH iteration'</span>, <span class="dt">ylab =</span> <span class="st">'x[5]'</span>)
<span class="kw">abline</span>(<span class="dt">h=</span>data_<span class="op">$</span>x_true[<span class="dv">5</span>], <span class="dt">col =</span> <span class="dv">3</span>)</code></pre></div>
<p><img src="rbiips_demo_files/figure-html/unnamed-chunk-6-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="dt">bty=</span><span class="st">'l'</span>)

<span class="kw">matplot</span>(<span class="kw">do.call</span>(cbind, summ_pimh<span class="op">$</span>x<span class="op">$</span>quant), 
        <span class="dt">type=</span><span class="st">'n'</span>, <span class="dt">xlab=</span><span class="st">'t'</span>, <span class="dt">ylab=</span><span class="st">'x[t]'</span>)
<span class="kw">lines</span>(summ_pimh<span class="op">$</span>x<span class="op">$</span>mean)
<span class="kw">matlines</span>(<span class="kw">do.call</span>(cbind, summ_pimh<span class="op">$</span>x<span class="op">$</span>quant), <span class="dt">col=</span><span class="dv">1</span>, <span class="dt">lty=</span><span class="dv">2</span>)
<span class="kw">lines</span>(data_<span class="op">$</span>x_true, <span class="dt">col=</span><span class="dv">3</span>)
<span class="kw">legend</span>(<span class="st">'topleft'</span>, 
       <span class="dt">leg=</span><span class="kw">c</span>(<span class="st">'PIMH estimate'</span>, <span class="st">'true'</span>),
       <span class="dt">col=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>), <span class="dt">lty=</span><span class="dv">1</span>, <span class="dt">bty=</span><span class="st">'n'</span>)

<span class="kw">matplot</span>(<span class="kw">c</span>(<span class="dv">1</span>,tmax), <span class="kw">c</span>(<span class="dv">0</span>,<span class="fl">2.5</span>), <span class="dt">type=</span><span class="st">'n'</span>, <span class="dt">xlab=</span><span class="st">'t'</span>, <span class="dt">ylab=</span><span class="st">'c[t]==1'</span>, <span class="dt">yaxt=</span><span class="st">'n'</span>)
<span class="kw">lines</span>(<span class="dv">2</span><span class="op">:</span>tmax, .<span class="dv">5</span><span class="op">+</span>summ_pimh[[<span class="st">'c[2:10]'</span>]]<span class="op">$</span>mode, <span class="dt">type=</span><span class="st">'S'</span>)
<span class="kw">lines</span>(<span class="op">-</span><span class="dv">1</span><span class="op">+</span>data_<span class="op">$</span>c_true, <span class="dt">type=</span><span class="st">'S'</span>, <span class="dt">col=</span><span class="dv">3</span>)
<span class="kw">legend</span>(<span class="st">'topleft'</span>, 
       <span class="dt">leg=</span><span class="kw">c</span>(<span class="st">'PIMH mode'</span>, <span class="st">'true'</span>),
       <span class="dt">col=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>), <span class="dt">lty=</span><span class="dv">1</span>, <span class="dt">bty=</span><span class="st">'n'</span>)

<span class="kw">plot</span>(<span class="kw"><a href="../reference/smcarray-object.html">biips_density</a></span>(out_pimh[[<span class="st">'x[5]'</span>]]))
<span class="kw">abline</span>(<span class="dt">v=</span>data_<span class="op">$</span>x_true[<span class="dv">5</span>], <span class="dt">col=</span><span class="dv">3</span>)

<span class="kw">plot</span>(<span class="kw"><a href="../reference/smcarray-object.html">biips_table</a></span>(out_pimh[[<span class="st">'c[5]'</span>]]))
<span class="kw">points</span>(data_<span class="op">$</span>c_true[<span class="dv">5</span>], <span class="dv">0</span>, <span class="dt">col=</span><span class="dv">3</span>, <span class="dt">pch=</span><span class="dv">17</span>)</code></pre></div>
<p><img src="rbiips_demo_files/figure-html/unnamed-chunk-6-2.png" width="672"></p>
</div>
<div id="smc-sensitivity-analysis" class="section level1">
<h1 class="hasAnchor">
<a href="#smc-sensitivity-analysis" class="anchor"></a>SMC sensitivity analysis</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">n_part &lt;-<span class="st"> </span><span class="dv">50</span>
logtau_val &lt;-<span class="st"> </span><span class="op">-</span><span class="dv">10</span><span class="op">:</span><span class="dv">10</span>
out_sens &lt;-<span class="st"> </span><span class="kw"><a href="../reference/biips_smc_sensitivity.html">biips_smc_sensitivity</a></span>(model, <span class="kw">list</span>(<span class="dt">logtau =</span> logtau_val), n_part)</code></pre></div>
<pre><code>## * Analyzing sensitivity with 50 particles
##   |--------------------------------------------------| 100%
##   |**************************************************| 21 iterations in 0.32 s</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">1</span>), <span class="dt">bty=</span><span class="st">'l'</span>)
<span class="kw">plot</span>(logtau_val, out_sens<span class="op">$</span>log_marg_like, <span class="dt">type=</span><span class="st">'l'</span>,
     <span class="dt">xlab =</span> <span class="st">'logtau'</span>, <span class="dt">ylab =</span> <span class="st">'log p(y | logtau)'</span>)
<span class="kw">abline</span>(<span class="dt">v=</span>data_<span class="op">$</span>logtau_true, <span class="dt">col=</span><span class="dv">3</span>)

<span class="kw">plot</span>(logtau_val, out_sens<span class="op">$</span>log_marg_like_pen, <span class="dt">type=</span><span class="st">'l'</span>,
     <span class="dt">xlab =</span> <span class="st">'logtau'</span>, <span class="dt">ylab =</span> <span class="st">'log p(y, logtau)'</span>)
<span class="kw">abline</span>(<span class="dt">v=</span>data_<span class="op">$</span>logtau_true, <span class="dt">col=</span><span class="dv">3</span>)</code></pre></div>
<p><img src="rbiips_demo_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
</div>
<div id="pmmh-algorithm" class="section level1">
<h1 class="hasAnchor">
<a href="#pmmh-algorithm" class="anchor"></a>PMMH algorithm</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data_ &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">tmax =</span> <span class="dv">10</span>, <span class="dt">p =</span> <span class="kw">c</span>(.<span class="dv">5</span>, .<span class="dv">5</span>), <span class="dt">logtau_true =</span> <span class="kw">log</span>(<span class="dv">1</span>))
model &lt;-<span class="st"> </span><span class="kw"><a href="../reference/biips_model.html">biips_model</a></span>(modelfile, data_)</code></pre></div>
<pre><code>## * Parsing model in: /home/adrien/R/x86_64-pc-linux-gnu-library/3.4/rbiips/extdata/hmm_f.bug
## * Compiling data graph
##   Declaring variables
##   Resolving undeclared variables
##   Allocating nodes
##   Graph size: 93
##   Sampling data
##   Reading data back into data table
## * Compiling model graph
##   Declaring variables
##   Resolving undeclared variables
##   Allocating nodes
##   Graph size: 105</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data_ &lt;-<span class="st"> </span>model<span class="op">$</span><span class="kw">data</span>()

n_part &lt;-<span class="st"> </span><span class="dv">50</span>
n_burn &lt;-<span class="st"> </span><span class="dv">100</span>
n_iter &lt;-<span class="st"> </span><span class="dv">100</span>
obj_pmmh &lt;-<span class="st"> </span><span class="kw"><a href="../reference/biips_pmmh_init.html">biips_pmmh_init</a></span>(model, <span class="st">'logtau'</span>, 
                            <span class="dt">latent_names =</span> <span class="kw">c</span>(<span class="st">'x'</span>, <span class="st">'c[2:10]'</span>, <span class="st">'x[5]'</span>, <span class="st">'c[5]'</span>),
                            <span class="dt">inits =</span> <span class="kw">list</span>(<span class="dt">logtau =</span> <span class="op">-</span><span class="dv">1</span>))  <span class="co"># Initialize</span></code></pre></div>
<pre><code>## * Initializing PMMH</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">out_pmmh_burn &lt;-<span class="st"> </span><span class="kw"><a href="../reference/pmmh-object.html">biips_pmmh_update</a></span>(obj_pmmh, n_burn, n_part)  <span class="co"># Burn-in</span></code></pre></div>
<pre><code>## * Adapting PMMH with 50 particles
##   |--------------------------------------------------| 100%
##   |++++++++++++++++++++++++++++++++++++++++++++++++++| 100 iterations in 1.88 s</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">out_pmmh &lt;-<span class="st"> </span><span class="kw"><a href="../reference/pmmh-object.html">biips_pmmh_samples</a></span>(obj_pmmh, n_iter, n_part, <span class="dt">thin =</span> <span class="dv">1</span>)  <span class="co"># Samples</span></code></pre></div>
<pre><code>## * Generating 100 PMMH samples with 50 particles
##   |--------------------------------------------------| 100%
##   |**************************************************| 100 iterations in 1.67 s</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">summ_pmmh &lt;-<span class="st"> </span><span class="kw"><a href="../reference/smcarray-object.html">biips_summary</a></span>(out_pmmh, <span class="dt">probs=</span><span class="kw">c</span>(.<span class="dv">025</span>, <span class="fl">0.975</span>))

<span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="dt">bty=</span><span class="st">'l'</span>)

<span class="kw">plot</span>(<span class="kw">c</span>(out_pmmh_burn<span class="op">$</span>log_marg_like_pen, out_pimh<span class="op">$</span>log_marg_like_pen),
     <span class="dt">type =</span> <span class="st">'l'</span>, <span class="dt">xlab =</span> <span class="st">'PMMH iteration'</span>, <span class="dt">ylab =</span> <span class="st">'log p(y, logtau)'</span>)

<span class="kw">plot</span>(n_burn<span class="op">+</span>(<span class="dv">1</span><span class="op">:</span>n_iter), <span class="kw">c</span>(out_pmmh<span class="op">$</span>logtau),
     <span class="dt">type =</span> <span class="st">'l'</span>, <span class="dt">xlab =</span> <span class="st">'PMMH iteration'</span>, <span class="dt">ylab =</span> <span class="st">'logtau'</span>)
<span class="kw">abline</span>(<span class="dt">h=</span>data_<span class="op">$</span>logtau_true, <span class="dt">col =</span> <span class="dv">3</span>)

<span class="kw">plot</span>(<span class="kw"><a href="../reference/smcarray-object.html">biips_density</a></span>(out_pmmh<span class="op">$</span>logtau))
<span class="kw">abline</span>(<span class="dt">v=</span>data_<span class="op">$</span>logtau_true, <span class="dt">col=</span><span class="dv">3</span>)

<span class="kw"><a href="../reference/mcmcarray-object.html">biips_hist</a></span>(out_pmmh<span class="op">$</span>logtau)
<span class="kw">abline</span>(<span class="dt">v=</span>data_<span class="op">$</span>logtau_true, <span class="dt">col=</span><span class="dv">3</span>)</code></pre></div>
<p><img src="rbiips_demo_files/figure-html/unnamed-chunk-8-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">matplot</span>(<span class="kw">do.call</span>(cbind, summ_pmmh<span class="op">$</span>x<span class="op">$</span>quant), 
        <span class="dt">type=</span><span class="st">'n'</span>, <span class="dt">xlab=</span><span class="st">'t'</span>, <span class="dt">ylab=</span><span class="st">'x[t]'</span>)
<span class="kw">lines</span>(summ_pmmh<span class="op">$</span>x<span class="op">$</span>mean)
<span class="kw">matlines</span>(<span class="kw">do.call</span>(cbind, summ_pmmh<span class="op">$</span>x<span class="op">$</span>quant), <span class="dt">lty=</span><span class="dv">2</span>, <span class="dt">col=</span><span class="dv">1</span>)
<span class="kw">lines</span>(data_<span class="op">$</span>x_true, <span class="dt">col=</span><span class="dv">3</span>)
<span class="kw">legend</span>(<span class="st">'topleft'</span>, 
       <span class="dt">leg=</span><span class="kw">c</span>(<span class="st">'PMMH estimate'</span>, <span class="st">'true'</span>),
       <span class="dt">col=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>), <span class="dt">lty=</span><span class="dv">1</span>, <span class="dt">bty=</span><span class="st">'n'</span>)

<span class="kw">matplot</span>(<span class="kw">c</span>(<span class="dv">1</span>,tmax), <span class="kw">c</span>(<span class="dv">0</span>,<span class="fl">2.5</span>), <span class="dt">type=</span><span class="st">'n'</span>, <span class="dt">xlab=</span><span class="st">'t'</span>, <span class="dt">ylab=</span><span class="st">'c[t]==1'</span>, <span class="dt">yaxt=</span><span class="st">'n'</span>)
<span class="kw">lines</span>(<span class="dv">2</span><span class="op">:</span>tmax, .<span class="dv">5</span><span class="op">+</span>summ_pmmh[[<span class="st">'c[2:10]'</span>]]<span class="op">$</span>mode, <span class="dt">type=</span><span class="st">'S'</span>)
<span class="kw">lines</span>(<span class="op">-</span><span class="dv">1</span><span class="op">+</span>data_<span class="op">$</span>c_true, <span class="dt">type=</span><span class="st">'S'</span>, <span class="dt">col=</span><span class="dv">3</span>)
<span class="kw">legend</span>(<span class="st">'topleft'</span>, 
       <span class="dt">leg=</span><span class="kw">c</span>(<span class="st">'PMMH mode'</span>, <span class="st">'true'</span>),
       <span class="dt">col=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>), <span class="dt">lty=</span><span class="dv">1</span>, <span class="dt">bty=</span><span class="st">'n'</span>)

<span class="kw">plot</span>(<span class="kw"><a href="../reference/smcarray-object.html">biips_density</a></span>(out_pmmh[[<span class="st">'x[5]'</span>]]))
<span class="kw">abline</span>(<span class="dt">v=</span>data_<span class="op">$</span>x_true[<span class="dv">5</span>], <span class="dt">col=</span><span class="dv">3</span>)

<span class="kw">plot</span>(<span class="kw"><a href="../reference/smcarray-object.html">biips_table</a></span>(out_pmmh[[<span class="st">'c[5]'</span>]]))
<span class="kw">points</span>(data_<span class="op">$</span>c_true[<span class="dv">5</span>], <span class="dv">0</span>, <span class="dt">col=</span><span class="dv">3</span>, <span class="dt">pch=</span><span class="dv">17</span>)</code></pre></div>
<p><img src="rbiips_demo_files/figure-html/unnamed-chunk-8-2.png" width="672"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#add-custom-functions-and-distributions-to-bugs-language">Add custom functions and distributions to BUGS language</a></li>
      <li><a href="#compile-model">Compile model</a></li>
      <li><a href="#smc-algorithm">SMC algorithm</a></li>
      <li><a href="#pimh-algorithm">PIMH algorithm</a></li>
      <li><a href="#smc-sensitivity-analysis">SMC sensitivity analysis</a></li>
      <li><a href="#pmmh-algorithm">PMMH algorithm</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Adrien Todeschini, François Caron.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
