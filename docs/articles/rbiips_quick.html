<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quick examples of rbiips usage â€¢ rbiips</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/simplex/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Google analytics --><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-31640193-1', 'auto');
  ga('send', 'pageview');

</script>
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">rbiips</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/biips/rbiips">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Quick examples of rbiips usage</h1>
                        <h4 class="author">Adrien Todeschini, Francois Caron</h4>
            
            <h4 class="date">2016-12-29</h4>
          </div>

    
    
<div class="contents">
<p>This vignette gathers the examples used in the rbiips reference manual.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">0</span>)
<span class="kw">require</span>(rbiips)</code></pre></div>
<div id="add-custom-functions-and-distributions-to-bugs-language" class="section level1">
<h1 class="hasAnchor">
<html><body><a href="#add-custom-functions-and-distributions-to-bugs-language" class="anchor"> </a></body></html>Add custom functions and distributions to BUGS language</h1>
<p>Add custom function <code>f</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">f_dim &lt;-<span class="st"> </span>function(x_dim, t_dim) {
  <span class="co"># Check dimensions of the input and return dimension of the output of function f</span>
  <span class="kw">stopifnot</span>(<span class="kw">prod</span>(x_dim) ==<span class="st"> </span><span class="dv">1</span>, <span class="kw">prod</span>(t_dim) ==<span class="st"> </span><span class="dv">1</span>)
  x_dim
}
f_eval &lt;-<span class="st"> </span>function(x, t) {
  <span class="co"># Evaluate function f</span>
  <span class="fl">0.5</span> *<span class="st"> </span>x +<span class="st"> </span><span class="dv">25</span> *<span class="st"> </span>x/(<span class="dv">1</span> +<span class="st"> </span>x^<span class="dv">2</span>) +<span class="st"> </span><span class="dv">8</span> *<span class="st"> </span><span class="kw">cos</span>(<span class="fl">1.2</span> *<span class="st"> </span>t)
}
<span class="kw"><a href="../reference/extend-bugs.html">biips_add_function</a></span>(<span class="st">'f'</span>, <span class="dv">2</span>, f_dim, f_eval)</code></pre></div>
<pre><code>## * Added function f</code></pre>
<p>Add custom sampling distribution <code>dMN</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dMN_dim &lt;-<span class="st"> </span>function(mu_dim, Sig_dim) {
  <span class="co"># Check dimensions of the input and return dimension of the output of</span>
  <span class="co"># distribution dMN</span>
  <span class="kw">stopifnot</span>(<span class="kw">prod</span>(mu_dim) ==<span class="st"> </span>mu_dim[<span class="dv">1</span>], <span class="kw">length</span>(Sig_dim) ==<span class="st"> </span><span class="dv">2</span>, mu_dim[<span class="dv">1</span>] ==<span class="st"> </span>Sig_dim)
  mu_dim
}
dMN_sample &lt;-<span class="st"> </span>function(mu, Sig) {
  <span class="co"># Draw a sample of distribution dMN</span>
  mu +<span class="st"> </span><span class="kw">t</span>(<span class="kw">chol</span>(Sig)) %*%<span class="st"> </span><span class="kw">rnorm</span>(<span class="kw">length</span>(mu))
}
<span class="kw"><a href="../reference/extend-bugs.html">biips_add_distribution</a></span>(<span class="st">'dMN'</span>, <span class="dv">2</span>, dMN_dim, dMN_sample)</code></pre></div>
<pre><code>## * Added distribution dMN</code></pre>
</div>
<div id="compile-model" class="section level1">
<h1 class="hasAnchor">
<html><body><a href="#compile-model" class="anchor"> </a></body></html>Compile model</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">modelfile &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">'extdata'</span>, <span class="st">'hmm_f.bug'</span>, <span class="dt">package =</span> <span class="st">'rbiips'</span>)
<span class="kw">stopifnot</span>(<span class="kw">nchar</span>(modelfile) &gt;<span class="st"> </span><span class="dv">0</span>)
<span class="kw">cat</span>(<span class="kw">readLines</span>(modelfile), <span class="dt">sep =</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</code></pre></div>
<pre><code>## var c_true[tmax], x_true[tmax], c[tmax], x[tmax], y[tmax]
## 
## data
## {
##   x_true[1] ~ dnorm(0, 1/5)
##   y[1] ~ dnorm(x_true[1], exp(logtau_true))
##   for (t in 2:tmax)
##   {
##     c_true[t] ~ dcat(p)
##     x_true[t] ~ dnorm(f(x_true[t-1], t-1), ifelse(c_true[t]==1, 1/10, 1/100))
##     y[t] ~ dnorm(x_true[t]/4, exp(logtau_true))
##   }
## }
## 
## model
## {
##   logtau ~ dunif(-3, 3)
##   x[1] ~ dnorm(0, 1/5)
##   y[1] ~ dnorm(x[1], exp(logtau))
##   for (t in 2:tmax)
##   {
##     c[t] ~ dcat(p)
##     x[t] ~ dnorm(f(x[t-1], t-1), ifelse(c[t]==1, 1/10, 1/100))
##     y[t] ~ dnorm(x[t]/4, exp(logtau))
##   }
## }</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">tmax =</span> <span class="dv">10</span>, <span class="dt">p =</span> <span class="kw">c</span>(.<span class="dv">5</span>, .<span class="dv">5</span>), <span class="dt">logtau_true =</span> <span class="kw">log</span>(<span class="dv">1</span>), <span class="dt">logtau =</span> <span class="kw">log</span>(<span class="dv">1</span>))
model &lt;-<span class="st"> </span><span class="kw"><a href="../reference/biips_model.html">biips_model</a></span>(modelfile, data, <span class="dt">sample_data =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## * Parsing model in: /home/adrien-alea/Dropbox/workspace/rbiips/inst/extdata/hmm_f.bug
## * Compiling data graph
##   Declaring variables
##   Resolving undeclared variables
##   Allocating nodes
##   Graph size: 94
##   Sampling data
##   Reading data back into data table
## * Compiling model graph
##   Declaring variables
##   Resolving undeclared variables
##   Allocating nodes
##   Graph size: 105</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># rm(model)</span>
<span class="co"># </span>
<span class="co"># tmax &lt;- 10</span>
<span class="co"># p &lt;- c(.5, .5)</span>
<span class="co"># logtau_true &lt;- log(1)</span>
<span class="co"># logtau &lt;- logtau_true</span>
<span class="co"># </span>
<span class="co"># datanames &lt;- c('tmax', 'p', 'logtau_true', 'logtau')</span>
<span class="co"># model &lt;- biips_model(modelfile, datanames, sample_data = TRUE)</span>

<span class="kw"><a href="../reference/biips-object.html">is.biips</a></span>(model)</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(model)</code></pre></div>
<pre><code>## Biips model:
## 
## var c_true[tmax], x_true[tmax], c[tmax], x[tmax], y[tmax]
## 
## data
## {
##   x_true[1] ~ dnorm(0, 1/5)
##   y[1] ~ dnorm(x_true[1], exp(logtau_true))
##   for (t in 2:tmax)
##   {
##     c_true[t] ~ dcat(p)
##     x_true[t] ~ dnorm(f(x_true[t-1], t-1), ifelse(c_true[t]==1, 1/10, 1/100))
##     y[t] ~ dnorm(x_true[t]/4, exp(logtau_true))
##   }
## }
## 
## model
## {
##   logtau ~ dunif(-3, 3)
##   x[1] ~ dnorm(0, 1/5)
##   y[1] ~ dnorm(x[1], exp(logtau))
##   for (t in 2:tmax)
##   {
##     c[t] ~ dcat(p)
##     x[t] ~ dnorm(f(x[t-1], t-1), ifelse(c[t]==1, 1/10, 1/100))
##     y[t] ~ dnorm(x[t]/4, exp(logtau))
##   }
## }
## 
## 
## Fully observed variables:
##  logtau logtau_true p tmax x_true y 
## 
## Partially observed variables:
##  c_true</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model$<span class="kw">data</span>()</code></pre></div>
<pre><code>## $c_true
##  [1] NA  1  1  2  1  1  1  2  1  2
## 
## $logtau
## [1] 0
## 
## $logtau_true
## [1] 0
## 
## $p
## [1] 0.5 0.5
## 
## $tmax
## [1] 10
## 
## $x_true
##  [1] -0.4169979 -9.0124859 -8.5502201 -9.0831363 -8.5299593  5.7598874
##  [7] 16.8533731  2.4722914  5.1386416 -1.2379888
## 
## $y
##  [1] -1.0915320 -2.8456504 -2.9185889 -1.7675427 -1.9918904  0.2540241
##  [7]  3.4715740  0.5880222  1.0806876  0.1869324</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">variable.names</span>(model)</code></pre></div>
<pre><code>## [1] "c"           "c_true"      "logtau"      "logtau_true" "p"          
## [6] "tmax"        "x"           "x_true"      "y"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/biips-object.html">biips_variable_names</a></span>(model)</code></pre></div>
<pre><code>## [1] "c"           "c_true"      "logtau"      "logtau_true" "p"          
## [6] "tmax"        "x"           "x_true"      "y"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/biips-object.html">biips_nodes</a></span>(model)</code></pre></div>
<pre><code>##      id                                name  type observed discrete
## 1     0                           c_true[2] const     TRUE     TRUE
## 2     1                           c_true[3] const     TRUE     TRUE
## 3     2                           c_true[4] const     TRUE     TRUE
## 4     3                           c_true[5] const     TRUE     TRUE
## 5     4                           c_true[6] const     TRUE     TRUE
## 6     5                           c_true[7] const     TRUE     TRUE
## 7     6                           c_true[8] const     TRUE     TRUE
## 8     7                           c_true[9] const     TRUE     TRUE
## 9     8                          c_true[10] const     TRUE     TRUE
## 10    9                         logtau_true const     TRUE     TRUE
## 11   10                                   p const     TRUE    FALSE
## 12   11                                tmax const     TRUE     TRUE
## 13   12                              x_true const     TRUE    FALSE
## 14   13                                   3 const     TRUE     TRUE
## 15   14                                (-3) logic     TRUE     TRUE
## 16   15                              logtau stoch     TRUE    FALSE
## 17   21                       (exp(logtau)) logic     TRUE    FALSE
## 18   16                                   0 const     TRUE     TRUE
## 19   17                                   1 const     TRUE     TRUE
## 20   38                               (3-1) logic     TRUE     TRUE
## 21   18                                   5 const     TRUE     TRUE
## 22   19                               (1/5) logic     TRUE    FALSE
## 23   54                               (5-1) logic     TRUE     TRUE
## 24   20                                x[1] stoch    FALSE    FALSE
## 25   22                                y[1] stoch     TRUE    FALSE
## 26   23                                c[2] stoch    FALSE     TRUE
## 27   27                           (c[2]==1) logic    FALSE     TRUE
## 28   24                                   2 const     TRUE     TRUE
## 29   25                               (2-1) logic     TRUE     TRUE
## 30   26                     (f(x[1],(2-1))) logic    FALSE    FALSE
## 31   28                                  10 const     TRUE     TRUE
## 32   29                              (1/10) logic     TRUE    FALSE
## 33   98                              (10-1) logic     TRUE     TRUE
## 34   30                                 100 const     TRUE     TRUE
## 35   31                             (1/100) logic     TRUE    FALSE
## 36   32  (ifelse((c[2]==1),(1/10),(1/100))) logic    FALSE    FALSE
## 37   33                                x[2] stoch    FALSE    FALSE
## 38   39                     (f(x[2],(3-1))) logic    FALSE    FALSE
## 39   34                                   4 const     TRUE     TRUE
## 40   35                            (x[2]/4) logic    FALSE    FALSE
## 41   36                                y[2] stoch     TRUE    FALSE
## 42   46                               (4-1) logic     TRUE     TRUE
## 43   37                                c[3] stoch    FALSE     TRUE
## 44   40                           (c[3]==1) logic    FALSE     TRUE
## 45   41  (ifelse((c[3]==1),(1/10),(1/100))) logic    FALSE    FALSE
## 46   42                                x[3] stoch    FALSE    FALSE
## 47   43                            (x[3]/4) logic    FALSE    FALSE
## 48   44                                y[3] stoch     TRUE    FALSE
## 49   47                     (f(x[3],(4-1))) logic    FALSE    FALSE
## 50   45                                c[4] stoch    FALSE     TRUE
## 51   48                           (c[4]==1) logic    FALSE     TRUE
## 52   49  (ifelse((c[4]==1),(1/10),(1/100))) logic    FALSE    FALSE
## 53   50                                x[4] stoch    FALSE    FALSE
## 54   51                            (x[4]/4) logic    FALSE    FALSE
## 55   52                                y[4] stoch     TRUE    FALSE
## 56   55                     (f(x[4],(5-1))) logic    FALSE    FALSE
## 57   53                                c[5] stoch    FALSE     TRUE
## 58   56                           (c[5]==1) logic    FALSE     TRUE
## 59   57  (ifelse((c[5]==1),(1/10),(1/100))) logic    FALSE    FALSE
## 60   58                                x[5] stoch    FALSE    FALSE
## 61   59                            (x[5]/4) logic    FALSE    FALSE
## 62   60                                y[5] stoch     TRUE    FALSE
## 63   61                                c[6] stoch    FALSE     TRUE
## 64   65                           (c[6]==1) logic    FALSE     TRUE
## 65   66  (ifelse((c[6]==1),(1/10),(1/100))) logic    FALSE    FALSE
## 66   62                                   6 const     TRUE     TRUE
## 67   63                               (6-1) logic     TRUE     TRUE
## 68   64                     (f(x[5],(6-1))) logic    FALSE    FALSE
## 69   67                                x[6] stoch    FALSE    FALSE
## 70   68                            (x[6]/4) logic    FALSE    FALSE
## 71   69                                y[6] stoch     TRUE    FALSE
## 72   70                                c[7] stoch    FALSE     TRUE
## 73   74                           (c[7]==1) logic    FALSE     TRUE
## 74   75  (ifelse((c[7]==1),(1/10),(1/100))) logic    FALSE    FALSE
## 75   71                                   7 const     TRUE     TRUE
## 76   72                               (7-1) logic     TRUE     TRUE
## 77   73                     (f(x[6],(7-1))) logic    FALSE    FALSE
## 78   76                                x[7] stoch    FALSE    FALSE
## 79   77                            (x[7]/4) logic    FALSE    FALSE
## 80   78                                y[7] stoch     TRUE    FALSE
## 81   79                                c[8] stoch    FALSE     TRUE
## 82   83                           (c[8]==1) logic    FALSE     TRUE
## 83   84  (ifelse((c[8]==1),(1/10),(1/100))) logic    FALSE    FALSE
## 84   80                                   8 const     TRUE     TRUE
## 85   81                               (8-1) logic     TRUE     TRUE
## 86   82                     (f(x[7],(8-1))) logic    FALSE    FALSE
## 87   85                                x[8] stoch    FALSE    FALSE
## 88   86                            (x[8]/4) logic    FALSE    FALSE
## 89   87                                y[8] stoch     TRUE    FALSE
## 90   88                                c[9] stoch    FALSE     TRUE
## 91   92                           (c[9]==1) logic    FALSE     TRUE
## 92   93  (ifelse((c[9]==1),(1/10),(1/100))) logic    FALSE    FALSE
## 93   89                                   9 const     TRUE     TRUE
## 94   90                               (9-1) logic     TRUE     TRUE
## 95   91                     (f(x[8],(9-1))) logic    FALSE    FALSE
## 96   94                                x[9] stoch    FALSE    FALSE
## 97   95                            (x[9]/4) logic    FALSE    FALSE
## 98   96                                y[9] stoch     TRUE    FALSE
## 99   99                    (f(x[9],(10-1))) logic    FALSE    FALSE
## 100  97                               c[10] stoch    FALSE     TRUE
## 101 100                          (c[10]==1) logic    FALSE     TRUE
## 102 101 (ifelse((c[10]==1),(1/10),(1/100))) logic    FALSE    FALSE
## 103 102                               x[10] stoch    FALSE    FALSE
## 104 103                           (x[10]/4) logic    FALSE    FALSE
## 105 104                               y[10] stoch     TRUE    FALSE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># dotfile &lt;- 'hmm.dot'</span>
<span class="co"># biips_print_dot(model, dotfile)</span>
<span class="co"># cat(readLines(dotfile), sep = '\n')</span></code></pre></div>
</div>
<div id="smc-algorithm" class="section level1">
<h1 class="hasAnchor">
<html><body><a href="#smc-algorithm" class="anchor"> </a></body></html>SMC algorithm</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/biips-object.html">biips_build_sampler</a></span>(model, <span class="dt">proposal =</span> <span class="st">'prior'</span>)</code></pre></div>
<pre><code>## * Assigning node samplers</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/biips-object.html">biips_nodes</a></span>(model, <span class="dt">type =</span> <span class="st">'stoch'</span>, <span class="dt">observed =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>##      id  name  type observed discrete iteration sampler
## 24   20  x[1] stoch    FALSE    FALSE         0   Prior
## 26   23  c[2] stoch    FALSE     TRUE         1   Prior
## 37   33  x[2] stoch    FALSE    FALSE         1   Prior
## 43   37  c[3] stoch    FALSE     TRUE         2   Prior
## 46   42  x[3] stoch    FALSE    FALSE         2   Prior
## 50   45  c[4] stoch    FALSE     TRUE         3   Prior
## 53   50  x[4] stoch    FALSE    FALSE         3   Prior
## 57   53  c[5] stoch    FALSE     TRUE         4   Prior
## 60   58  x[5] stoch    FALSE    FALSE         4   Prior
## 63   61  c[6] stoch    FALSE     TRUE         5   Prior
## 69   67  x[6] stoch    FALSE    FALSE         5   Prior
## 72   70  c[7] stoch    FALSE     TRUE         6   Prior
## 78   76  x[7] stoch    FALSE    FALSE         6   Prior
## 81   79  c[8] stoch    FALSE     TRUE         7   Prior
## 87   85  x[8] stoch    FALSE    FALSE         7   Prior
## 90   88  c[9] stoch    FALSE     TRUE         8   Prior
## 96   94  x[9] stoch    FALSE    FALSE         8   Prior
## 100  97 c[10] stoch    FALSE     TRUE         9   Prior
## 103 102 x[10] stoch    FALSE    FALSE         9   Prior</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/biips-object.html">biips_build_sampler</a></span>(model, <span class="dt">proposal =</span> <span class="st">'auto'</span>)</code></pre></div>
<pre><code>## * Assigning node samplers</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/biips-object.html">biips_nodes</a></span>(model, <span class="dt">type =</span> <span class="st">'stoch'</span>, <span class="dt">observed =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>##      id  name  type observed discrete iteration
## 24   20  x[1] stoch    FALSE    FALSE         0
## 26   23  c[2] stoch    FALSE     TRUE         1
## 37   33  x[2] stoch    FALSE    FALSE         1
## 43   37  c[3] stoch    FALSE     TRUE         2
## 46   42  x[3] stoch    FALSE    FALSE         2
## 50   45  c[4] stoch    FALSE     TRUE         3
## 53   50  x[4] stoch    FALSE    FALSE         3
## 57   53  c[5] stoch    FALSE     TRUE         4
## 60   58  x[5] stoch    FALSE    FALSE         4
## 63   61  c[6] stoch    FALSE     TRUE         5
## 69   67  x[6] stoch    FALSE    FALSE         5
## 72   70  c[7] stoch    FALSE     TRUE         6
## 78   76  x[7] stoch    FALSE    FALSE         6
## 81   79  c[8] stoch    FALSE     TRUE         7
## 87   85  x[8] stoch    FALSE    FALSE         7
## 90   88  c[9] stoch    FALSE     TRUE         8
## 96   94  x[9] stoch    FALSE    FALSE         8
## 100  97 c[10] stoch    FALSE     TRUE         9
## 103 102 x[10] stoch    FALSE    FALSE         9
##                                  sampler
## 24             ConjugateNormal_knownPrec
## 26                                 Prior
## 37  ConjugateNormal_knownPrec_linearMean
## 43                                 Prior
## 46  ConjugateNormal_knownPrec_linearMean
## 50                                 Prior
## 53  ConjugateNormal_knownPrec_linearMean
## 57                                 Prior
## 60  ConjugateNormal_knownPrec_linearMean
## 63                                 Prior
## 69  ConjugateNormal_knownPrec_linearMean
## 72                                 Prior
## 78  ConjugateNormal_knownPrec_linearMean
## 81                                 Prior
## 87  ConjugateNormal_knownPrec_linearMean
## 90                                 Prior
## 96  ConjugateNormal_knownPrec_linearMean
## 100                                Prior
## 103 ConjugateNormal_knownPrec_linearMean</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">n_part &lt;-<span class="st"> </span><span class="dv">100</span>
out_smc &lt;-<span class="st"> </span><span class="kw"><a href="../reference/biips_smc_samples.html">biips_smc_samples</a></span>(model, <span class="kw">c</span>(<span class="st">'x'</span>, <span class="st">'c[2:10]'</span>), n_part, <span class="dt">type =</span> <span class="st">'fs'</span>, 
                             <span class="dt">rs_thres =</span> <span class="fl">0.5</span>, <span class="dt">rs_type =</span> <span class="st">'stratified'</span>)</code></pre></div>
<pre><code>## * Running SMC forward sampler with 100 particles
##   |--------------------------------------------------| 100%
##   |**************************************************| 10 iterations in 0.04 s</code></pre>
<p>Manipulate <code>smcarray.fsb.list</code> object</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/smcarray-object.html">is.smcarray.fsb.list</a></span>(out_smc)</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(out_smc)</code></pre></div>
<pre><code>## [1] "c[2:10]"       "x"             "log_marg_like"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">out_smc</code></pre></div>
<pre><code>## c[2:10] filtering smcarray:
## $mode
## [1] 1 1 2 1 1 1 1 1 1
## 
## Marginalizing over: particle(100) 
## 
## c[2:10] smoothing smcarray:
## $mode
## [1] 1 1 2 2 1 1 1 1 1
## 
## Marginalizing over: particle(100) 
## 
## 
## x filtering smcarray:
## $mean
##  [1]  -0.8185253 -10.2517614 -12.8818052  -9.8706867  -7.6815614
##  [6]   1.0595768  13.3149162   3.7425798   2.7491513   1.8172149
## 
## Marginalizing over: particle(100) 
## 
## x smoothing smcarray:
## $mean
##  [1]  -1.075535  -9.946487 -11.013764  -9.784847  -7.637991   2.329093
##  [7]  13.109354   4.027466   3.708989   1.817215
## 
## Marginalizing over: particle(100) 
## 
## 
## Log-marginal likelihood:  -30.7798</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/smcarray-object.html">biips_diagnosis</a></span>(out_smc)</code></pre></div>
<pre><code>## * Diagnosis of variable: c[2:10] 
##   Filtering: GOOD
##   Smoothing: POOR
##     The minimum effective sample size is too low: 27.97195 
##     Estimates may be poor for some variables.
##     You should increase the number of particles
## .* Diagnosis of variable: x[1:10] 
##   Filtering: GOOD
##   Smoothing: POOR
##     The minimum effective sample size is too low: 27.97195 
##     Estimates may be poor for some variables.
##     You should increase the number of particles
## .</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/smcarray-object.html">biips_summary</a></span>(out_smc)</code></pre></div>
<pre><code>## c[2:10] filtering smcarray:
## $mode
## [1] 1 1 2 1 1 1 1 1 1
## 
## Marginalizing over: particle(100) 
## 
## c[2:10] smoothing smcarray:
## $mode
## [1] 1 1 2 2 1 1 1 1 1
## 
## Marginalizing over: particle(100) 
## 
## 
## x filtering smcarray:
## $mean
##  [1]  -0.8185253 -10.2517614 -12.8818052  -9.8706867  -7.6815614
##  [6]   1.0595768  13.3149162   3.7425798   2.7491513   1.8172149
## 
## Marginalizing over: particle(100) 
## 
## x smoothing smcarray:
## $mean
##  [1]  -1.075535  -9.946487 -11.013764  -9.784847  -7.637991   2.329093
##  [7]  13.109354   4.027466   3.708989   1.817215
## 
## Marginalizing over: particle(100)</code></pre>
<p>Manipulate <code>smcarray.fsb</code> object</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/smcarray-object.html">is.smcarray.fsb</a></span>(out_smc$x)</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(out_smc$x)</code></pre></div>
<pre><code>## [1] "f" "s"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">out_smc$x</code></pre></div>
<pre><code>## filtering smcarray:
## $mean
##  [1]  -0.8185253 -10.2517614 -12.8818052  -9.8706867  -7.6815614
##  [6]   1.0595768  13.3149162   3.7425798   2.7491513   1.8172149
## 
## Marginalizing over: particle(100) 
## 
## smoothing smcarray:
## $mean
##  [1]  -1.075535  -9.946487 -11.013764  -9.784847  -7.637991   2.329093
##  [7]  13.109354   4.027466   3.708989   1.817215
## 
## Marginalizing over: particle(100)</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/smcarray-object.html">biips_diagnosis</a></span>(out_smc$x)</code></pre></div>
<pre><code>## * Diagnosis of variable: x[1:10] 
##   Filtering: GOOD
##   Smoothing: POOR
##     The minimum effective sample size is too low: 27.97195 
##     Estimates may be poor for some variables.
##     You should increase the number of particles
## .</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">summ_smc_x &lt;-<span class="st"> </span><span class="kw"><a href="../reference/smcarray-object.html">biips_summary</a></span>(out_smc$x, <span class="dt">order =</span> <span class="dv">2</span>, <span class="dt">probs =</span> <span class="kw">c</span>(.<span class="dv">025</span>, .<span class="dv">975</span>))
summ_smc_x</code></pre></div>
<pre><code>## filtering smcarray:
## $mean
##  [1]  -0.8185253 -10.2517614 -12.8818052  -9.8706867  -7.6815614
##  [6]   1.0595768  13.3149162   3.7425798   2.7491513   1.8172149
## 
## $var
##  [1]  0.8775959 10.3845628 10.0910990 12.8956952 10.4889376  9.8139604
##  [7] 11.4422620 10.0852628 12.4712790 17.9677167
## 
## $probs
## [1] 0.025 0.975
## 
## $quant
## $quant$`0.025`
##  [1]  -2.866675 -15.788782 -19.256900 -15.502403 -12.487758  -5.176027
##  [7]   6.445461  -2.852484  -6.067787  -8.844806
## 
## $quant$`0.975`
##  [1]  0.7994907 -5.8594096 -7.1421828 -2.1920464  0.6055832  6.3867482
##  [7] 21.9042089  9.6784921  9.6400095  8.5410838
## 
## 
## Marginalizing over: particle(100) 
## 
## smoothing smcarray:
## $mean
##  [1]  -1.075535  -9.946487 -11.013764  -9.784847  -7.637991   2.329093
##  [7]  13.109354   4.027466   3.708989   1.817215
## 
## $var
##  [1]  0.4346656 12.3371170 10.0835960 12.5825530  8.4151323  4.6000299
##  [7] 11.5865528  6.5097952 10.3312927 17.9677167
## 
## $probs
## [1] 0.025 0.975
## 
## $quant
## $quant$`0.025`
##  [1]  -2.6896954 -15.3198851 -17.9929574 -16.4190998 -12.6144800
##  [6]  -1.0743896   9.3638397   0.1327257  -5.6650842  -8.8448065
## 
## $quant$`0.975`
##  [1] -0.1746461 -4.0527912 -6.0713340 -2.7427490 -0.5104330  6.3790631
##  [7] 21.8172044  9.6164381 10.0119652  8.5410838
## 
## 
## Marginalizing over: particle(100)</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dens_smc_x &lt;-<span class="st"> </span><span class="kw"><a href="../reference/smcarray-object.html">biips_density</a></span>(out_smc$x, <span class="dt">bw =</span> <span class="st">'nrd0'</span>, <span class="dt">adjust =</span> <span class="dv">1</span>, <span class="dt">n =</span> <span class="dv">100</span>)
<span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))
<span class="kw">plot</span>(dens_smc_x)</code></pre></div>
<p><img src="rbiips_quick_files/figure-html/unnamed-chunk-7-1.png" width="672"><img src="rbiips_quick_files/figure-html/unnamed-chunk-7-2.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/smcarray-object.html">is.smcarray.fsb</a></span>(out_smc[[<span class="st">'c[2:10]'</span>]])</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(out_smc[[<span class="st">'c[2:10]'</span>]])</code></pre></div>
<pre><code>## [1] "f" "s"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">out_smc[[<span class="st">'c[2:10]'</span>]]</code></pre></div>
<pre><code>## filtering smcarray:
## $mode
## [1] 1 1 2 1 1 1 1 1 1
## 
## Marginalizing over: particle(100) 
## 
## smoothing smcarray:
## $mode
## [1] 1 1 2 2 1 1 1 1 1
## 
## Marginalizing over: particle(100)</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/smcarray-object.html">biips_diagnosis</a></span>(out_smc[[<span class="st">'c[2:10]'</span>]])</code></pre></div>
<pre><code>## * Diagnosis of variable: c[2:10] 
##   Filtering: GOOD
##   Smoothing: POOR
##     The minimum effective sample size is too low: 27.97195 
##     Estimates may be poor for some variables.
##     You should increase the number of particles
## .</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">summ_smc_c &lt;-<span class="st"> </span><span class="kw"><a href="../reference/smcarray-object.html">biips_summary</a></span>(out_smc[[<span class="st">'c[2:10]'</span>]])
summ_smc_c</code></pre></div>
<pre><code>## filtering smcarray:
## $mode
## [1] 1 1 2 1 1 1 1 1 1
## 
## Marginalizing over: particle(100) 
## 
## smoothing smcarray:
## $mode
## [1] 1 1 2 2 1 1 1 1 1
## 
## Marginalizing over: particle(100)</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">table_smc_c &lt;-<span class="st"> </span><span class="kw"><a href="../reference/smcarray-object.html">biips_table</a></span>(out_smc[[<span class="st">'c[2:10]'</span>]])
<span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</code></pre></div>
<p><img src="rbiips_quick_files/figure-html/unnamed-chunk-7-3.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(table_smc_c)</code></pre></div>
<p><img src="rbiips_quick_files/figure-html/unnamed-chunk-7-4.png" width="672"><img src="rbiips_quick_files/figure-html/unnamed-chunk-7-5.png" width="672"><img src="rbiips_quick_files/figure-html/unnamed-chunk-7-6.png" width="672"></p>
<p>Manipulate <code>smcarray</code> object</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/smcarray-object.html">is.smcarray</a></span>(out_smc$x$f)</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(out_smc$x$f)</code></pre></div>
<pre><code>##  [1] "values"       "weights"      "ess"          "discrete"    
##  [5] "iterations"   "conditionals" "name"         "lower"       
##  [9] "upper"        "type"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">out_smc$x$f</code></pre></div>
<pre><code>## smcarray:
## $mean
##  [1]  -0.8185253 -10.2517614 -12.8818052  -9.8706867  -7.6815614
##  [6]   1.0595768  13.3149162   3.7425798   2.7491513   1.8172149
## 
## Marginalizing over: particle(100)</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">out_smc$x$s</code></pre></div>
<pre><code>## smcarray:
## $mean
##  [1]  -1.075535  -9.946487 -11.013764  -9.784847  -7.637991   2.329093
##  [7]  13.109354   4.027466   3.708989   1.817215
## 
## Marginalizing over: particle(100)</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/smcarray-object.html">biips_diagnosis</a></span>(out_smc$x$f)</code></pre></div>
<pre><code>## * Diagnosis of variable: x[1:10] 
##   Filtering: GOOD</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/smcarray-object.html">biips_diagnosis</a></span>(out_smc$x$s)</code></pre></div>
<pre><code>## * Diagnosis of variable: x[1:10] 
##   Smoothing: POOR
##     The minimum effective sample size is too low: 27.97195 
##     Estimates may be poor for some variables.
##     You should increase the number of particles
## .</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/smcarray-object.html">biips_summary</a></span>(out_smc$x$f)</code></pre></div>
<pre><code>## smcarray:
## $mean
##  [1]  -0.8185253 -10.2517614 -12.8818052  -9.8706867  -7.6815614
##  [6]   1.0595768  13.3149162   3.7425798   2.7491513   1.8172149
## 
## Marginalizing over: particle(100)</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/smcarray-object.html">biips_summary</a></span>(out_smc$x$s)</code></pre></div>
<pre><code>## smcarray:
## $mean
##  [1]  -1.075535  -9.946487 -11.013764  -9.784847  -7.637991   2.329093
##  [7]  13.109354   4.027466   3.708989   1.817215
## 
## Marginalizing over: particle(100)</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))
<span class="kw">plot</span>(<span class="kw"><a href="../reference/smcarray-object.html">biips_density</a></span>(out_smc$x$f))</code></pre></div>
<p><img src="rbiips_quick_files/figure-html/unnamed-chunk-8-1.png" width="672"><img src="rbiips_quick_files/figure-html/unnamed-chunk-8-2.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</code></pre></div>
<p><img src="rbiips_quick_files/figure-html/unnamed-chunk-8-3.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(<span class="kw"><a href="../reference/smcarray-object.html">biips_density</a></span>(out_smc$x$s))</code></pre></div>
<p><img src="rbiips_quick_files/figure-html/unnamed-chunk-8-4.png" width="672"><img src="rbiips_quick_files/figure-html/unnamed-chunk-8-5.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</code></pre></div>
<p><img src="rbiips_quick_files/figure-html/unnamed-chunk-8-6.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(<span class="kw"><a href="../reference/smcarray-object.html">biips_table</a></span>(out_smc[[<span class="st">'c[2:10]'</span>]]$f))</code></pre></div>
<p><img src="rbiips_quick_files/figure-html/unnamed-chunk-8-7.png" width="672"><img src="rbiips_quick_files/figure-html/unnamed-chunk-8-8.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</code></pre></div>
<p><img src="rbiips_quick_files/figure-html/unnamed-chunk-8-9.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(<span class="kw"><a href="../reference/smcarray-object.html">biips_table</a></span>(out_smc[[<span class="st">'c[2:10]'</span>]]$s))</code></pre></div>
<p><img src="rbiips_quick_files/figure-html/unnamed-chunk-8-10.png" width="672"><img src="rbiips_quick_files/figure-html/unnamed-chunk-8-11.png" width="672"><img src="rbiips_quick_files/figure-html/unnamed-chunk-8-12.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))
<span class="kw">plot</span>(model$<span class="kw">data</span>()$x_true, <span class="dt">type =</span> <span class="st">'l'</span>, <span class="dt">col =</span> <span class="st">'green'</span>, <span class="dt">xlab =</span> <span class="st">'t'</span>, <span class="dt">ylab =</span> <span class="st">'x[t]'</span>)
<span class="kw">lines</span>(summ_smc_x$f$mean, <span class="dt">col =</span> <span class="st">'blue'</span>)
<span class="kw">lines</span>(summ_smc_x$s$mean, <span class="dt">col =</span> <span class="st">'red'</span>)
<span class="kw">matlines</span>(<span class="kw">matrix</span>(<span class="kw">unlist</span>(summ_smc_x$f$quant), data$tmax), <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">'blue'</span>)
<span class="kw">matlines</span>(<span class="kw">matrix</span>(<span class="kw">unlist</span>(summ_smc_x$s$quant), data$tmax), <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">'red'</span>)
<span class="kw">legend</span>(<span class="st">'topright'</span>, <span class="dt">leg =</span> <span class="kw">c</span>(<span class="st">'true'</span>, <span class="st">'SMC filtering estimate'</span>, <span class="st">'SMC smoothing estimate'</span>),
  <span class="dt">lty =</span> <span class="dv">1</span>, <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">'green'</span>, <span class="st">'blue'</span>, <span class="st">'red'</span>), <span class="dt">bty =</span> <span class="st">'n'</span>)

<span class="kw">barplot</span>(.<span class="dv">5</span>*(model$<span class="kw">data</span>()$c_true==<span class="dv">1</span>), <span class="dt">col =</span> <span class="st">'green'</span>, <span class="dt">border =</span> <span class="ot">NA</span>, <span class="dt">space =</span> <span class="dv">0</span>, <span class="dt">offset=</span><span class="dv">2</span>, 
        <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">3</span>), <span class="dt">xlab=</span><span class="st">'t'</span>, <span class="dt">ylab=</span><span class="st">'c[t]==1'</span>, <span class="dt">axes =</span> <span class="ot">FALSE</span>)
<span class="kw">axis</span>(<span class="dv">1</span>, <span class="dt">at=</span><span class="dv">1</span>:data$tmax<span class="fl">-.5</span>, <span class="dt">labels=</span><span class="dv">1</span>:data$tmax)
<span class="kw">axis</span>(<span class="dv">2</span>, <span class="dt">line =</span> <span class="dv">1</span>, <span class="dt">at=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">3</span>), <span class="dt">labels=</span><span class="ot">NA</span>)
<span class="kw">text</span>(data$tmax/<span class="dv">2</span>, <span class="fl">2.75</span>, <span class="st">'true'</span>)
<span class="kw">barplot</span>(.<span class="dv">5</span>*<span class="kw">c</span>(<span class="ot">NA</span>, summ_smc_c$f$mode==<span class="dv">1</span>), <span class="dt">col =</span> <span class="st">'blue'</span>, <span class="dt">border =</span> <span class="ot">NA</span>, <span class="dt">space =</span> <span class="dv">0</span>, 
        <span class="dt">offset=</span><span class="dv">1</span>, <span class="dt">axes =</span> <span class="ot">FALSE</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)
<span class="kw">text</span>(data$tmax/<span class="dv">2</span>, <span class="fl">1.75</span>, <span class="st">'SMC filtering mode'</span>)
<span class="kw">barplot</span>(.<span class="dv">5</span>*<span class="kw">c</span>(<span class="ot">NA</span>, summ_smc_c$s$mode==<span class="dv">1</span>), <span class="dt">col =</span> <span class="st">'red'</span>, <span class="dt">border =</span> <span class="ot">NA</span>, <span class="dt">space =</span> <span class="dv">0</span>, 
        <span class="dt">axes =</span> <span class="ot">FALSE</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)
<span class="kw">text</span>(data$tmax/<span class="dv">2</span>, .<span class="dv">75</span>, <span class="st">'SMC smoothing mode'</span>)

t &lt;-<span class="st"> </span><span class="dv">5</span>
<span class="kw">plot</span>(dens_smc_x[[t]], <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">'blue'</span>,<span class="st">'red'</span>), <span class="dt">ylab =</span> <span class="st">'posterior density'</span>)
<span class="kw">points</span>(model$<span class="kw">data</span>()$x_true[t], <span class="dv">0</span>, <span class="dt">pch =</span> <span class="dv">17</span>, <span class="dt">col =</span> <span class="st">'green'</span>)

<span class="kw">plot</span>(table_smc_c[[t<span class="dv">-1</span>]], <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">'blue'</span>,<span class="st">'red'</span>), <span class="dt">ylab =</span> <span class="st">'posterior probability mass'</span>)
<span class="kw">points</span>(model$<span class="kw">data</span>()$c_true[t], <span class="dv">0</span>, <span class="dt">pch =</span> <span class="dv">17</span>, <span class="dt">col =</span> <span class="st">'green'</span>)</code></pre></div>
<p><img src="rbiips_quick_files/figure-html/unnamed-chunk-9-1.png" width="672"></p>
</div>
<div id="pimh-algorithm" class="section level1">
<h1 class="hasAnchor">
<html><body><a href="#pimh-algorithm" class="anchor"> </a></body></html>PIMH algorithm</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">modelfile &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">'extdata'</span>, <span class="st">'hmm.bug'</span>, <span class="dt">package =</span> <span class="st">'rbiips'</span>)
<span class="kw">stopifnot</span>(<span class="kw">nchar</span>(modelfile) &gt;<span class="st"> </span><span class="dv">0</span>)
<span class="kw">cat</span>(<span class="kw">readLines</span>(modelfile), <span class="dt">sep =</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</code></pre></div>
<pre><code>## var c_true[tmax], x_true[tmax], c[tmax], x[tmax], y[tmax]
## 
## data
## {
##   x_true[1] ~ dnorm(0, 1/5)
##   y[1] ~ dnorm(x_true[1], exp(logtau_true))
##   for (t in 2:tmax)
##   {
##     c_true[t] ~ dcat(p)
##     x_true[t] ~ dnorm(0.5*x_true[t-1]+25*x_true[t-1]/(1+x_true[t-1]^2)+8*cos(1.2*(t-1)), ifelse(c_true[t]==1, 1/10, 1/100))
##     y[t] ~ dnorm(x_true[t]/4, exp(logtau_true))
##   }
## }
## 
## model
## {
##   logtau ~ dunif(-3, 3)
##   x[1] ~ dnorm(0, 1/5)
##   y[1] ~ dnorm(x[1], exp(logtau))
##   for (t in 2:tmax)
##   {
##     c[t] ~ dcat(p)
##     x[t] ~ dnorm(0.5*x[t-1]+25*x[t-1]/(1+x[t-1]^2)+8*cos(1.2*(t-1)), ifelse(c[t]==1, 1/10, 1/100))
##     y[t] ~ dnorm(x[t]/4, exp(logtau))
##   }
## }</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">tmax =</span> <span class="dv">10</span>, <span class="dt">p =</span> <span class="kw">c</span>(.<span class="dv">5</span>, .<span class="dv">5</span>), <span class="dt">logtau_true =</span> <span class="kw">log</span>(<span class="dv">1</span>), <span class="dt">logtau =</span> <span class="kw">log</span>(<span class="dv">1</span>))
model &lt;-<span class="st"> </span><span class="kw"><a href="../reference/biips_model.html">biips_model</a></span>(modelfile, data)</code></pre></div>
<pre><code>## * Parsing model in: /home/adrien-alea/Dropbox/workspace/rbiips/inst/extdata/hmm.bug
## * Compiling data graph
##   Declaring variables
##   Resolving undeclared variables
##   Allocating nodes
##   Graph size: 169
##   Sampling data
##   Reading data back into data table
## * Compiling model graph
##   Declaring variables
##   Resolving undeclared variables
##   Allocating nodes
##   Graph size: 180</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">n_part &lt;-<span class="st"> </span><span class="dv">50</span>
obj_pimh &lt;-<span class="st"> </span><span class="kw"><a href="../reference/biips_pimh_init.html">biips_pimh_init</a></span>(model, <span class="kw">c</span>(<span class="st">'x'</span>, <span class="st">'c[2:10]'</span>))  <span class="co"># Initialize</span></code></pre></div>
<pre><code>## * Initializing PIMH</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/pimh-object.html">is.pimh</a></span>(obj_pimh)</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">out_pimh_burn &lt;-<span class="st"> </span><span class="kw"><a href="../reference/pimh-object.html">biips_pimh_update</a></span>(obj_pimh, <span class="dv">100</span>, n_part)  <span class="co"># Burn-in</span></code></pre></div>
<pre><code>## * Updating PIMH with 50 particles
##   |--------------------------------------------------| 100%
##   |**************************************************| 100 iterations in 0.33 s</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">out_pimh &lt;-<span class="st"> </span><span class="kw"><a href="../reference/pimh-object.html">biips_pimh_samples</a></span>(obj_pimh, <span class="dv">100</span>, n_part)  <span class="co"># Samples</span></code></pre></div>
<pre><code>## * Generating PIMH samples with 50 particles
##   |--------------------------------------------------| 100%
##   |**************************************************| 100 iterations in 0.33 s</code></pre>
<p>Manipulate <code>mcmcarray.list</code> object</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/mcmcarray-object.html">is.mcmcarray.list</a></span>(out_pimh)</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(out_pimh)</code></pre></div>
<pre><code>## [1] "log_marg_like" "x"             "c[2:10]"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">out_pimh</code></pre></div>
<pre><code>## x mcmcarray:
## $mean
##  [1]  -1.613836  -6.353550 -10.483263 -17.839060 -20.823216  -2.420225
##  [7]   2.983367   8.388451  -7.033464  -8.962055
## 
## Marginalizing over: iteration(100) 
## 
## c[2:10] mcmcarray:
## $mode
## [1] 1 1 1 2 1 2 2 2 1
## 
## Marginalizing over: iteration(100)</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/smcarray-object.html">biips_summary</a></span>(out_pimh)</code></pre></div>
<pre><code>## x mcmcarray:
## $mean
##  [1]  -1.613836  -6.353550 -10.483263 -17.839060 -20.823216  -2.420225
##  [7]   2.983367   8.388451  -7.033464  -8.962055
## 
## Marginalizing over: iteration(100) 
## 
## c[2:10] mcmcarray:
## $mode
## [1] 1 1 1 2 1 2 2 2 1
## 
## Marginalizing over: iteration(100)</code></pre>
<p>Manipulate <code>mcmcarray</code> object</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/mcmcarray-object.html">is.mcmcarray</a></span>(out_pimh$x)</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">out_pimh$x</code></pre></div>
<pre><code>## mcmcarray:
## $mean
##  [1]  -1.613836  -6.353550 -10.483263 -17.839060 -20.823216  -2.420225
##  [7]   2.983367   8.388451  -7.033464  -8.962055
## 
## Marginalizing over: iteration(100)</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">summ_pimh_x &lt;-<span class="st"> </span><span class="kw"><a href="../reference/smcarray-object.html">biips_summary</a></span>(out_pimh$x, <span class="dt">order =</span> <span class="dv">2</span>, <span class="dt">probs =</span> <span class="kw">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))
summ_pimh_x</code></pre></div>
<pre><code>## mcmcarray:
## $mean
##  [1]  -1.613836  -6.353550 -10.483263 -17.839060 -20.823216  -2.420225
##  [7]   2.983367   8.388451  -7.033464  -8.962055
## 
## $var
##  [1]  0.778814  8.827180  9.837912 11.921994 13.579435 14.048946 11.942517
##  [8] 11.846091 12.755484  6.759405
## 
## $probs
## [1] 0.025 0.975
## 
## $quant
## $quant$`0.025`
##  [1]  -3.032682 -11.325302 -17.866211 -26.147449 -26.908129  -8.277551
##  [7]  -3.292180   2.947437 -15.195251 -14.605218
## 
## $quant$`0.975`
##  [1]  -0.1100123  -0.2314135  -3.9108981 -12.5970942 -13.2585757
##  [6]   6.1863795  12.0359348  16.0097494  -1.6227136  -3.5394095
## 
## 
## Marginalizing over: iteration(100)</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dens_pimh_x &lt;-<span class="st"> </span><span class="kw"><a href="../reference/smcarray-object.html">biips_density</a></span>(out_pimh$x)
<span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))
<span class="kw">plot</span>(dens_pimh_x)</code></pre></div>
<p><img src="rbiips_quick_files/figure-html/unnamed-chunk-12-1.png" width="672"><img src="rbiips_quick_files/figure-html/unnamed-chunk-12-2.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</code></pre></div>
<p><img src="rbiips_quick_files/figure-html/unnamed-chunk-12-3.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/mcmcarray-object.html">biips_hist</a></span>(out_pimh$x)</code></pre></div>
<p><img src="rbiips_quick_files/figure-html/unnamed-chunk-12-4.png" width="672"><img src="rbiips_quick_files/figure-html/unnamed-chunk-12-5.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/mcmcarray-object.html">is.mcmcarray</a></span>(out_pimh[[<span class="st">'c[2:10]'</span>]])</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">out_pimh[[<span class="st">'c[2:10]'</span>]]</code></pre></div>
<pre><code>## mcmcarray:
## $mode
## [1] 1 1 1 2 1 2 2 2 1
## 
## Marginalizing over: iteration(100)</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">summ_pimh_c &lt;-<span class="st"> </span><span class="kw"><a href="../reference/smcarray-object.html">biips_summary</a></span>(out_pimh[[<span class="st">'c[2:10]'</span>]])
summ_pimh_c</code></pre></div>
<pre><code>## mcmcarray:
## $mode
## [1] 1 1 1 2 1 2 2 2 1
## 
## Marginalizing over: iteration(100)</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">table_pimh_c &lt;-<span class="st"> </span><span class="kw"><a href="../reference/smcarray-object.html">biips_table</a></span>(out_pimh[[<span class="st">'c[2:10]'</span>]])
<span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</code></pre></div>
<p><img src="rbiips_quick_files/figure-html/unnamed-chunk-12-6.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(table_pimh_c)</code></pre></div>
<p><img src="rbiips_quick_files/figure-html/unnamed-chunk-12-7.png" width="672"><img src="rbiips_quick_files/figure-html/unnamed-chunk-12-8.png" width="672"><img src="rbiips_quick_files/figure-html/unnamed-chunk-12-9.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">1</span>))
<span class="kw">plot</span>(<span class="kw">c</span>(out_pimh_burn$log_marg_like, out_pimh$log_marg_like), <span class="dt">type =</span> <span class="st">'l'</span>, <span class="dt">col =</span> <span class="st">'blue'</span>,
  <span class="dt">xlab =</span> <span class="st">'PIMH iteration'</span>, <span class="dt">ylab =</span> <span class="st">'log p(y)'</span>)

t &lt;-<span class="st"> </span><span class="dv">5</span>
<span class="kw">plot</span>(out_pimh$x[t, ], <span class="dt">type =</span> <span class="st">'l'</span>, <span class="dt">col =</span> <span class="st">'blue'</span>, <span class="dt">xlab =</span> <span class="st">'PIMH iteration'</span>, 
     <span class="dt">ylab =</span> <span class="kw">paste0</span>(<span class="st">'x['</span>,t,<span class="st">']'</span>))
<span class="kw">points</span>(<span class="dv">0</span>, model$<span class="kw">data</span>()$x_true[t], <span class="dt">pch =</span> <span class="dv">17</span>, <span class="dt">col =</span> <span class="st">'green'</span>)</code></pre></div>
<p><img src="rbiips_quick_files/figure-html/unnamed-chunk-13-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))
<span class="kw">plot</span>(model$<span class="kw">data</span>()$x_true, <span class="dt">type =</span> <span class="st">'l'</span>, <span class="dt">col =</span> <span class="st">'green'</span>, <span class="dt">xlab =</span> <span class="st">'t'</span>, <span class="dt">ylab =</span> <span class="st">'x[t]'</span>)
<span class="kw">lines</span>(summ_pimh_x$mean, <span class="dt">col =</span> <span class="st">'blue'</span>)
<span class="kw">matlines</span>(<span class="kw">matrix</span>(<span class="kw">unlist</span>(summ_pimh_x$quant), data$tmax), <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">'blue'</span>)
<span class="kw">legend</span>(<span class="st">'topright'</span>, <span class="dt">leg =</span> <span class="kw">c</span>(<span class="st">'true'</span>, <span class="st">'PIMH estimate'</span>), <span class="dt">lty =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">1</span>), <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">'green'</span>,
  <span class="st">'blue'</span>), <span class="dt">bty =</span> <span class="st">'n'</span>)

<span class="kw">barplot</span>(.<span class="dv">5</span>*(model$<span class="kw">data</span>()$c_true==<span class="dv">1</span>), <span class="dt">col =</span> <span class="st">'green'</span>, <span class="dt">border =</span> <span class="ot">NA</span>, <span class="dt">space =</span> <span class="dv">0</span>, <span class="dt">offset =</span> <span class="dv">1</span>, 
        <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">2</span>), <span class="dt">xlab=</span><span class="st">'t'</span>, <span class="dt">ylab=</span><span class="st">'c[t]==1'</span>, <span class="dt">axes =</span> <span class="ot">FALSE</span>)
<span class="kw">axis</span>(<span class="dv">1</span>, <span class="dt">at=</span><span class="dv">1</span>:data$tmax<span class="fl">-.5</span>, <span class="dt">labels=</span><span class="dv">1</span>:data$tmax)
<span class="kw">axis</span>(<span class="dv">2</span>, <span class="dt">line =</span> <span class="dv">1</span>, <span class="dt">at=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">2</span>), <span class="dt">labels=</span><span class="ot">NA</span>)
<span class="kw">text</span>(data$tmax/<span class="dv">2</span>, <span class="fl">1.75</span>, <span class="st">'true'</span>)
<span class="kw">barplot</span>(.<span class="dv">5</span>*<span class="kw">c</span>(<span class="ot">NA</span>, summ_pimh_c$mode==<span class="dv">1</span>), <span class="dt">col =</span> <span class="st">'blue'</span>, <span class="dt">border =</span> <span class="ot">NA</span>, <span class="dt">space =</span> <span class="dv">0</span>, <span class="dt">axes =</span> <span class="ot">FALSE</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)
<span class="kw">text</span>(data$tmax/<span class="dv">2</span>, .<span class="dv">75</span>, <span class="st">'PIMH mode'</span>)

<span class="kw">plot</span>(dens_pimh_x[[t]], <span class="dt">col=</span><span class="st">'blue'</span>, <span class="dt">main =</span> , <span class="dt">ylab =</span> <span class="st">'posterior density'</span>)
<span class="kw">points</span>(model$<span class="kw">data</span>()$x_true[t], <span class="dv">0</span>, <span class="dt">pch =</span> <span class="dv">17</span>, <span class="dt">col =</span> <span class="st">'green'</span>)

<span class="kw">plot</span>(table_pimh_c[[t<span class="dv">-1</span>]], <span class="dt">col=</span><span class="st">'blue'</span>, <span class="dt">ylab =</span> <span class="st">'posterior probability mass'</span>)
<span class="kw">points</span>(model$<span class="kw">data</span>()$c_true[t], <span class="dv">0</span>, <span class="dt">pch =</span> <span class="dv">17</span>, <span class="dt">col =</span> <span class="st">'green'</span>)</code></pre></div>
<p><img src="rbiips_quick_files/figure-html/unnamed-chunk-13-2.png" width="672"></p>
</div>
<div id="smc-sensitivity-analysis" class="section level1">
<h1 class="hasAnchor">
<html><body><a href="#smc-sensitivity-analysis" class="anchor"> </a></body></html>SMC sensitivity analysis</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">modelfile &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">'extdata'</span>, <span class="st">'hmm.bug'</span>, <span class="dt">package =</span> <span class="st">'rbiips'</span>)
<span class="kw">stopifnot</span>(<span class="kw">nchar</span>(modelfile) &gt;<span class="st"> </span><span class="dv">0</span>)
<span class="kw">cat</span>(<span class="kw">readLines</span>(modelfile), <span class="dt">sep =</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</code></pre></div>
<pre><code>## var c_true[tmax], x_true[tmax], c[tmax], x[tmax], y[tmax]
## 
## data
## {
##   x_true[1] ~ dnorm(0, 1/5)
##   y[1] ~ dnorm(x_true[1], exp(logtau_true))
##   for (t in 2:tmax)
##   {
##     c_true[t] ~ dcat(p)
##     x_true[t] ~ dnorm(0.5*x_true[t-1]+25*x_true[t-1]/(1+x_true[t-1]^2)+8*cos(1.2*(t-1)), ifelse(c_true[t]==1, 1/10, 1/100))
##     y[t] ~ dnorm(x_true[t]/4, exp(logtau_true))
##   }
## }
## 
## model
## {
##   logtau ~ dunif(-3, 3)
##   x[1] ~ dnorm(0, 1/5)
##   y[1] ~ dnorm(x[1], exp(logtau))
##   for (t in 2:tmax)
##   {
##     c[t] ~ dcat(p)
##     x[t] ~ dnorm(0.5*x[t-1]+25*x[t-1]/(1+x[t-1]^2)+8*cos(1.2*(t-1)), ifelse(c[t]==1, 1/10, 1/100))
##     y[t] ~ dnorm(x[t]/4, exp(logtau))
##   }
## }</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">tmax =</span> <span class="dv">10</span>, <span class="dt">p =</span> <span class="kw">c</span>(.<span class="dv">5</span>, .<span class="dv">5</span>), <span class="dt">logtau_true =</span> <span class="kw">log</span>(<span class="dv">1</span>), <span class="dt">logtau =</span> <span class="kw">log</span>(<span class="dv">1</span>))
model &lt;-<span class="st"> </span><span class="kw"><a href="../reference/biips_model.html">biips_model</a></span>(modelfile, data)</code></pre></div>
<pre><code>## * Parsing model in: /home/adrien-alea/Dropbox/workspace/rbiips/inst/extdata/hmm.bug
## * Compiling data graph
##   Declaring variables
##   Resolving undeclared variables
##   Allocating nodes
##   Graph size: 169
##   Sampling data
##   Reading data back into data table
## * Compiling model graph
##   Declaring variables
##   Resolving undeclared variables
##   Allocating nodes
##   Graph size: 180</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">n_part &lt;-<span class="st"> </span><span class="dv">50</span>
logtau_val &lt;-<span class="st"> </span>-<span class="dv">10</span>:<span class="dv">10</span>
out_sens &lt;-<span class="st"> </span><span class="kw"><a href="../reference/biips_smc_sensitivity.html">biips_smc_sensitivity</a></span>(model, <span class="kw">list</span>(<span class="dt">logtau =</span> logtau_val), n_part)</code></pre></div>
<pre><code>## * Analyzing sensitivity with 50 particles
##   |--------------------------------------------------| 100%
##   |**************************************************| 21 iterations in 0.06 s</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">1</span>))
<span class="kw">plot</span>(logtau_val, out_sens$log_marg_like, <span class="dt">type =</span> <span class="st">'l'</span>, <span class="dt">col =</span> <span class="st">'blue'</span>, 
     <span class="dt">xlab =</span> <span class="st">'logtau'</span>, <span class="dt">ylab =</span> <span class="st">'log p(y|logtau) '</span>, <span class="dt">main =</span> <span class="st">'SMC sensitivity'</span>)
<span class="kw">points</span>(data$logtau, <span class="kw">min</span>(out_sens$log_marg_like), <span class="dt">pch =</span> <span class="dv">17</span>, <span class="dt">col =</span> <span class="st">'green'</span>)

<span class="kw">plot</span>(logtau_val, out_sens$log_marg_like_pen, <span class="dt">type =</span> <span class="st">'l'</span>, <span class="dt">col =</span> <span class="st">'blue'</span>, 
     <span class="dt">xlab =</span> <span class="st">'logtau'</span>, <span class="dt">ylab =</span> <span class="st">'log p(y|logtau) + log p(logtau)'</span>)
plml &lt;-<span class="st"> </span>out_sens$log_marg_like_pen
ymin &lt;-<span class="st"> </span><span class="kw">min</span>(plml[<span class="kw">is.finite</span>(plml)])
<span class="kw">points</span>(data$logtau, ymin, <span class="dt">pch =</span> <span class="dv">17</span>, <span class="dt">col =</span> <span class="st">'green'</span>)</code></pre></div>
<p><img src="rbiips_quick_files/figure-html/unnamed-chunk-14-1.png" width="672"></p>
</div>
<div id="pmmh-algorithm" class="section level1">
<h1 class="hasAnchor">
<html><body><a href="#pmmh-algorithm" class="anchor"> </a></body></html>PMMH algorithm</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">modelfile &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">'extdata'</span>, <span class="st">'hmm.bug'</span>, <span class="dt">package =</span> <span class="st">'rbiips'</span>)
<span class="kw">stopifnot</span>(<span class="kw">nchar</span>(modelfile) &gt;<span class="st"> </span><span class="dv">0</span>)
<span class="kw">cat</span>(<span class="kw">readLines</span>(modelfile), <span class="dt">sep =</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</code></pre></div>
<pre><code>## var c_true[tmax], x_true[tmax], c[tmax], x[tmax], y[tmax]
## 
## data
## {
##   x_true[1] ~ dnorm(0, 1/5)
##   y[1] ~ dnorm(x_true[1], exp(logtau_true))
##   for (t in 2:tmax)
##   {
##     c_true[t] ~ dcat(p)
##     x_true[t] ~ dnorm(0.5*x_true[t-1]+25*x_true[t-1]/(1+x_true[t-1]^2)+8*cos(1.2*(t-1)), ifelse(c_true[t]==1, 1/10, 1/100))
##     y[t] ~ dnorm(x_true[t]/4, exp(logtau_true))
##   }
## }
## 
## model
## {
##   logtau ~ dunif(-3, 3)
##   x[1] ~ dnorm(0, 1/5)
##   y[1] ~ dnorm(x[1], exp(logtau))
##   for (t in 2:tmax)
##   {
##     c[t] ~ dcat(p)
##     x[t] ~ dnorm(0.5*x[t-1]+25*x[t-1]/(1+x[t-1]^2)+8*cos(1.2*(t-1)), ifelse(c[t]==1, 1/10, 1/100))
##     y[t] ~ dnorm(x[t]/4, exp(logtau))
##   }
## }</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">tmax =</span> <span class="dv">10</span>, <span class="dt">p =</span> <span class="kw">c</span>(.<span class="dv">5</span>, .<span class="dv">5</span>), <span class="dt">logtau_true =</span> <span class="kw">log</span>(<span class="dv">1</span>))
model &lt;-<span class="st"> </span><span class="kw"><a href="../reference/biips_model.html">biips_model</a></span>(modelfile, data)</code></pre></div>
<pre><code>## * Parsing model in: /home/adrien-alea/Dropbox/workspace/rbiips/inst/extdata/hmm.bug
## * Compiling data graph
##   Declaring variables
##   Resolving undeclared variables
##   Allocating nodes
##   Graph size: 168
##   Sampling data
##   Reading data back into data table
## * Compiling model graph
##   Declaring variables
##   Resolving undeclared variables
##   Allocating nodes
##   Graph size: 180</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">n_part &lt;-<span class="st"> </span><span class="dv">50</span>
obj_pmmh &lt;-<span class="st"> </span><span class="kw"><a href="../reference/biips_pmmh_init.html">biips_pmmh_init</a></span>(model, <span class="st">'logtau'</span>, <span class="dt">latent_names =</span> <span class="kw">c</span>(<span class="st">'x'</span>, <span class="st">'c[2:10]'</span>), 
                            <span class="dt">inits =</span> <span class="kw">list</span>(<span class="dt">logtau =</span> -<span class="dv">2</span>))  <span class="co"># Initialize</span></code></pre></div>
<pre><code>## * Initializing PMMH</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/pmmh-object.html">is.pmmh</a></span>(obj_pmmh)</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">out_pmmh_burn &lt;-<span class="st"> </span><span class="kw"><a href="../reference/pmmh-object.html">biips_pmmh_update</a></span>(obj_pmmh, <span class="dv">100</span>, n_part)  <span class="co"># Burn-in</span></code></pre></div>
<pre><code>## * Adapting PMMH with 50 particles
##   |--------------------------------------------------| 100%
##   |++++++++++++++++++++++++++++++++++++++++++++++++++| 100 iterations in 0.37 s</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">out_pmmh &lt;-<span class="st"> </span><span class="kw"><a href="../reference/pmmh-object.html">biips_pmmh_samples</a></span>(obj_pmmh, <span class="dv">100</span>, n_part, <span class="dt">thin =</span> <span class="dv">1</span>)  <span class="co"># Samples</span></code></pre></div>
<pre><code>## * Generating 100 PMMH samples with 50 particles
##   |--------------------------------------------------| 100%
##   |**************************************************| 100 iterations in 0.37 s</code></pre>
<p>Manipulate <code>mcmcarray.list</code> object</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/mcmcarray-object.html">is.mcmcarray.list</a></span>(out_pmmh)</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(out_pmmh)</code></pre></div>
<pre><code>## [1] "log_marg_like_pen" "logtau"            "x"                
## [4] "c[2:10]"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">out_pmmh</code></pre></div>
<pre><code>## logtau mcmcarray:
## $mean
## [1] -1.61708
## 
## Marginalizing over: iteration(100) 
## 
## x mcmcarray:
## $mean
##  [1]  0.9243176  8.8659184  2.8735556 15.7223242 11.5664504 18.2189786
##  [7] 12.8181889  6.8504351  8.7613999 -0.6750393
## 
## Marginalizing over: iteration(100) 
## 
## c[2:10] mcmcarray:
## $mode
## [1] 1 1 2 1 2 1 1 2 2
## 
## Marginalizing over: iteration(100)</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/smcarray-object.html">biips_summary</a></span>(out_pmmh)</code></pre></div>
<pre><code>## logtau mcmcarray:
## $mean
## [1] -1.61708
## 
## Marginalizing over: iteration(100) 
## 
## x mcmcarray:
## $mean
##  [1]  0.9243176  8.8659184  2.8735556 15.7223242 11.5664504 18.2189786
##  [7] 12.8181889  6.8504351  8.7613999 -0.6750393
## 
## Marginalizing over: iteration(100) 
## 
## c[2:10] mcmcarray:
## $mode
## [1] 1 1 2 1 2 1 1 2 2
## 
## Marginalizing over: iteration(100)</code></pre>
<p>Manipulate <code>mcmcarray</code> object</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/mcmcarray-object.html">is.mcmcarray</a></span>(out_pmmh$logtau)</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">out_pmmh$logtau</code></pre></div>
<pre><code>## mcmcarray:
## $mean
## [1] -1.61708
## 
## Marginalizing over: iteration(100)</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">summ_pmmh_lt &lt;-<span class="st"> </span><span class="kw"><a href="../reference/smcarray-object.html">biips_summary</a></span>(out_pmmh$logtau, <span class="dt">order =</span> <span class="dv">2</span>, <span class="dt">probs =</span> <span class="kw">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))
dens_pmmh_lt &lt;-<span class="st"> </span><span class="kw"><a href="../reference/smcarray-object.html">biips_density</a></span>(out_pmmh$logtau)
<span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">1</span>))
<span class="kw">plot</span>(dens_pmmh_lt)
<span class="kw"><a href="../reference/mcmcarray-object.html">biips_hist</a></span>(out_pmmh$logtau)</code></pre></div>
<p><img src="rbiips_quick_files/figure-html/unnamed-chunk-17-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/mcmcarray-object.html">is.mcmcarray</a></span>(out_pmmh$x)</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">out_pmmh$x</code></pre></div>
<pre><code>## mcmcarray:
## $mean
##  [1]  0.9243176  8.8659184  2.8735556 15.7223242 11.5664504 18.2189786
##  [7] 12.8181889  6.8504351  8.7613999 -0.6750393
## 
## Marginalizing over: iteration(100)</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">summ_pmmh_x &lt;-<span class="st"> </span><span class="kw"><a href="../reference/smcarray-object.html">biips_summary</a></span>(out_pmmh$x, <span class="dt">order =</span> <span class="dv">2</span>, <span class="dt">probs =</span> <span class="kw">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))
dens_pmmh_x &lt;-<span class="st"> </span><span class="kw"><a href="../reference/smcarray-object.html">biips_density</a></span>(out_pmmh$x)
<span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))
<span class="kw">plot</span>(dens_pmmh_x)</code></pre></div>
<p><img src="rbiips_quick_files/figure-html/unnamed-chunk-17-2.png" width="672"><img src="rbiips_quick_files/figure-html/unnamed-chunk-17-3.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</code></pre></div>
<p><img src="rbiips_quick_files/figure-html/unnamed-chunk-17-4.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/mcmcarray-object.html">biips_hist</a></span>(out_pmmh$x)</code></pre></div>
<p><img src="rbiips_quick_files/figure-html/unnamed-chunk-17-5.png" width="672"><img src="rbiips_quick_files/figure-html/unnamed-chunk-17-6.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/mcmcarray-object.html">is.mcmcarray</a></span>(out_pmmh[[<span class="st">'c[2:10]'</span>]])</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">out_pmmh[[<span class="st">'c[2:10]'</span>]]</code></pre></div>
<pre><code>## mcmcarray:
## $mode
## [1] 1 1 2 1 2 1 1 2 2
## 
## Marginalizing over: iteration(100)</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">summ_pmmh_c &lt;-<span class="st"> </span><span class="kw"><a href="../reference/smcarray-object.html">biips_summary</a></span>(out_pmmh[[<span class="st">'c[2:10]'</span>]])
table_pmmh_c &lt;-<span class="st"> </span><span class="kw"><a href="../reference/smcarray-object.html">biips_table</a></span>(out_pmmh[[<span class="st">'c[2:10]'</span>]])
<span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</code></pre></div>
<p><img src="rbiips_quick_files/figure-html/unnamed-chunk-17-7.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(table_pmmh_c)</code></pre></div>
<p><img src="rbiips_quick_files/figure-html/unnamed-chunk-17-8.png" width="672"><img src="rbiips_quick_files/figure-html/unnamed-chunk-17-9.png" width="672"><img src="rbiips_quick_files/figure-html/unnamed-chunk-17-10.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))
<span class="kw">plot</span>(<span class="kw">c</span>(out_pmmh_burn$log_marg_like_pen, out_pmmh$log_marg_like_pen), <span class="dt">type =</span> <span class="st">'l'</span>,
  <span class="dt">col =</span> <span class="st">'blue'</span>, <span class="dt">xlab =</span> <span class="st">'PMMH iteration'</span>, <span class="dt">ylab =</span> <span class="st">'log p(y|logtau) + log p(logtau)'</span>)

<span class="kw">plot</span>(out_pmmh$logtau[<span class="dv">1</span>, ], <span class="dt">type =</span> <span class="st">'l'</span>, <span class="dt">col =</span> <span class="st">'blue'</span>, 
     <span class="dt">xlab =</span> <span class="st">'PMMH iteration'</span>, <span class="dt">ylab =</span> <span class="st">'logtau'</span>)
<span class="kw">points</span>(<span class="dv">0</span>, model$<span class="kw">data</span>()$logtau_true, <span class="dt">pch =</span> <span class="dv">17</span>, <span class="dt">col =</span> <span class="st">'green'</span>)

<span class="kw">plot</span>(dens_pmmh_lt, <span class="dt">col =</span> <span class="st">'blue'</span>, <span class="dt">ylab =</span> <span class="st">'posterior density'</span>)
<span class="kw">points</span>(model$<span class="kw">data</span>()$logtau_true, <span class="dv">0</span>, <span class="dt">pch =</span> <span class="dv">17</span>, <span class="dt">col =</span> <span class="st">'green'</span>)

<span class="kw"><a href="../reference/mcmcarray-object.html">biips_hist</a></span>(out_pmmh$logtau, <span class="dt">col =</span> <span class="st">'blue'</span>, <span class="dt">ylab =</span> <span class="st">'posterior density'</span>)
<span class="kw">points</span>(model$<span class="kw">data</span>()$logtau_true, <span class="dv">0</span>, <span class="dt">pch =</span> <span class="dv">17</span>, <span class="dt">col =</span> <span class="st">'green'</span>)</code></pre></div>
<p><img src="rbiips_quick_files/figure-html/unnamed-chunk-18-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))
<span class="kw">plot</span>(model$<span class="kw">data</span>()$x_true, <span class="dt">type =</span> <span class="st">'l'</span>, <span class="dt">col =</span> <span class="st">'green'</span>, <span class="dt">xlab =</span> <span class="st">'t'</span>, <span class="dt">ylab =</span> <span class="st">'x[t]'</span>)
<span class="kw">lines</span>(summ_pmmh_x$mean, <span class="dt">col =</span> <span class="st">'blue'</span>)
<span class="kw">matlines</span>(<span class="kw">matrix</span>(<span class="kw">unlist</span>(summ_pmmh_x$quant), data$tmax), <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">'blue'</span>)
<span class="kw">legend</span>(<span class="st">'topright'</span>, <span class="dt">leg =</span> <span class="kw">c</span>(<span class="st">'true'</span>, <span class="st">'PMMH estimate'</span>), <span class="dt">lty =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">1</span>), 
       <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">'green'</span>, <span class="st">'blue'</span>), <span class="dt">bty =</span> <span class="st">'n'</span>)

<span class="kw">barplot</span>(.<span class="dv">5</span>*(model$<span class="kw">data</span>()$c_true==<span class="dv">1</span>), <span class="dt">col =</span> <span class="st">'green'</span>, <span class="dt">border =</span> <span class="ot">NA</span>, <span class="dt">space =</span> <span class="dv">0</span>, <span class="dt">offset =</span> <span class="dv">1</span>, 
        <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">2</span>), <span class="dt">xlab=</span><span class="st">'t'</span>, <span class="dt">ylab=</span><span class="st">'c[t]==1'</span>, <span class="dt">axes =</span> <span class="ot">FALSE</span>)
<span class="kw">axis</span>(<span class="dv">1</span>, <span class="dt">at=</span><span class="dv">1</span>:data$tmax<span class="fl">-.5</span>, <span class="dt">labels=</span><span class="dv">1</span>:data$tmax)
<span class="kw">axis</span>(<span class="dv">2</span>, <span class="dt">line =</span> <span class="dv">1</span>, <span class="dt">at=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">2</span>), <span class="dt">labels=</span><span class="ot">NA</span>)
<span class="kw">text</span>(data$tmax/<span class="dv">2</span>, <span class="fl">1.75</span>, <span class="st">'true'</span>)
<span class="kw">barplot</span>(.<span class="dv">5</span>*<span class="kw">c</span>(<span class="ot">NA</span>, summ_pmmh_c$mode==<span class="dv">1</span>), <span class="dt">col =</span> <span class="st">'blue'</span>, <span class="dt">border =</span> <span class="ot">NA</span>, <span class="dt">space =</span> <span class="dv">0</span>, <span class="dt">axes =</span> <span class="ot">FALSE</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)
<span class="kw">text</span>(data$tmax/<span class="dv">2</span>, .<span class="dv">75</span>, <span class="st">'PMMH mode'</span>)

t &lt;-<span class="st"> </span><span class="dv">5</span>
<span class="kw">plot</span>(dens_pmmh_x[[t]], <span class="dt">col=</span><span class="st">'blue'</span>, <span class="dt">ylab =</span> <span class="st">'posterior density'</span>)
<span class="kw">points</span>(model$<span class="kw">data</span>()$x_true[t], <span class="dv">0</span>, <span class="dt">pch =</span> <span class="dv">17</span>, <span class="dt">col =</span> <span class="st">'green'</span>)

<span class="kw">plot</span>(table_pmmh_c[[t<span class="dv">-1</span>]], <span class="dt">col=</span><span class="st">'blue'</span>, <span class="dt">ylab =</span> <span class="st">'posterior probability mass'</span>)
<span class="kw">points</span>(model$<span class="kw">data</span>()$c_true[t], <span class="dv">0</span>, <span class="dt">pch =</span> <span class="dv">17</span>, <span class="dt">col =</span> <span class="st">'green'</span>)</code></pre></div>
<p><img src="rbiips_quick_files/figure-html/unnamed-chunk-18-2.png" width="672"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#add-custom-functions-and-distributions-to-bugs-language">Add custom functions and distributions to BUGS language</a></li>
      <li><a href="#compile-model">Compile model</a></li>
      <li><a href="#smc-algorithm">SMC algorithm</a></li>
      <li><a href="#pimh-algorithm">PIMH algorithm</a></li>
      <li><a href="#smc-sensitivity-analysis">SMC sensitivity analysis</a></li>
      <li><a href="#pmmh-algorithm">PMMH algorithm</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Adrien Todeschini, Francois Caron.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
